<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.17">
  <compounddef id="transformations_8py" kind="file" language="Python">
    <compoundname>transformations.py</compoundname>
    <innerclass refid="classtf__quaternion_1_1transformations_1_1Arcball" prot="public">tf_quaternion::transformations::Arcball</innerclass>
    <innernamespace refid="namespacetf__quaternion_1_1transformations">tf_quaternion::transformations</innernamespace>
      <sectiondef kind="var">
      <memberdef kind="variable" id="transformations_8py_1a8f98c51a8dbb0040df423b3e95251742" prot="private" static="no" mutable="no">
        <type>string</type>
        <definition>string tf_quaternion::transformations.__docformat__</definition>
        <argsstring></argsstring>
        <name>__docformat__</name>
        <initializer>=  &quot;restructuredtext en&quot;</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="177" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="177" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="transformations_8py_1aca8c1677f4855c116dccf15a1069a214" prot="private" static="no" mutable="no">
        <type>float</type>
        <definition>float tf_quaternion::transformations._EPS</definition>
        <argsstring></argsstring>
        <name>_EPS</name>
        <initializer>=  numpy.finfo(float).eps * 4.0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1515" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1515" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="transformations_8py_1abde28de04278a5015a87827d22b24853" prot="private" static="no" mutable="no">
        <type>list</type>
        <definition>list tf_quaternion::transformations._NEXT_AXIS</definition>
        <argsstring></argsstring>
        <name>_NEXT_AXIS</name>
        <initializer>=  [1, 2, 0, 1]</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1518" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1518" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="transformations_8py_1ae1be9b7bcd1bd7cfa1e21d299df5140f" prot="private" static="no" mutable="no">
        <type>dictionary</type>
        <definition>dictionary tf_quaternion::transformations._AXES2TUPLE</definition>
        <argsstring></argsstring>
        <name>_AXES2TUPLE</name>
        <initializer>=  {
    &apos;sxyz&apos;: (0, 0, 0, 0), &apos;sxyx&apos;: (0, 0, 1, 0), &apos;sxzy&apos;: (0, 1, 0, 0),
    &apos;sxzx&apos;: (0, 1, 1, 0), &apos;syzx&apos;: (1, 0, 0, 0), &apos;syzy&apos;: (1, 0, 1, 0),
    &apos;syxz&apos;: (1, 1, 0, 0), &apos;syxy&apos;: (1, 1, 1, 0), &apos;szxy&apos;: (2, 0, 0, 0),
    &apos;szxz&apos;: (2, 0, 1, 0), &apos;szyx&apos;: (2, 1, 0, 0), &apos;szyz&apos;: (2, 1, 1, 0),
    &apos;rzyx&apos;: (0, 0, 0, 1), &apos;rxyx&apos;: (0, 0, 1, 1), &apos;ryzx&apos;: (0, 1, 0, 1),
    &apos;rxzx&apos;: (0, 1, 1, 1), &apos;rxzy&apos;: (1, 0, 0, 1), &apos;ryzy&apos;: (1, 0, 1, 1),
    &apos;rzxy&apos;: (1, 1, 0, 1), &apos;ryxy&apos;: (1, 1, 1, 1), &apos;ryxz&apos;: (2, 0, 0, 1),
    &apos;rzxz&apos;: (2, 0, 1, 1), &apos;rxyz&apos;: (2, 1, 0, 1), &apos;rzyz&apos;: (2, 1, 1, 1)}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1521" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1521" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="transformations_8py_1ac0a93d1940eec963a74e0d6badec1a90" prot="private" static="no" mutable="no">
        <type></type>
        <definition>tf_quaternion::transformations._TUPLE2AXES</definition>
        <argsstring></argsstring>
        <name>_TUPLE2AXES</name>
        <initializer>=  dict((v, k) for k, v in _AXES2TUPLE.items())</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1531" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1531" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="transformations_8py_1a0ceebd60027b2bec83db4147e89b73a4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.identity_matrix</definition>
        <argsstring>()</argsstring>
        <name>identity_matrix</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return 4x4 identity/unit matrix.

&gt;&gt;&gt; I = identity_matrix()
&gt;&gt;&gt; numpy.allclose(I, numpy.dot(I, I))
True
&gt;&gt;&gt; numpy.sum(I), numpy.trace(I)
(4.0, 4.0)
&gt;&gt;&gt; numpy.allclose(I, numpy.identity(4, dtype=numpy.float64))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="180" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="180" bodyend="194"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a3cb4f7e536525863b6221d26333d524a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.translation_matrix</definition>
        <argsstring>(direction)</argsstring>
        <name>translation_matrix</name>
        <param>
          <type>direction</type>
          <defname>direction</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to translate by direction vector.

&gt;&gt;&gt; v = numpy.random.random(3) - 0.5
&gt;&gt;&gt; numpy.allclose(v, translation_matrix(v)[:3, 3])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="195" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="195" bodyend="207"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a3b0a3b0170dce13e8e92fa9b44a970c7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.translation_from_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>translation_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return translation vector from translation matrix.

&gt;&gt;&gt; v0 = numpy.random.random(3) - 0.5
&gt;&gt;&gt; v1 = translation_from_matrix(translation_matrix(v0))
&gt;&gt;&gt; numpy.allclose(v0, v1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="208" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="208" bodyend="219"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a3bfce81ccb8e161c495d461759c5ba9c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.reflection_matrix</definition>
        <argsstring>(point, normal)</argsstring>
        <name>reflection_matrix</name>
        <param>
          <type>point</type>
          <defname>point</defname>
        </param>
        <param>
          <type>normal</type>
          <defname>normal</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to mirror at plane defined by point and normal vector.

&gt;&gt;&gt; v0 = numpy.random.random(4) - 0.5
&gt;&gt;&gt; v0[3] = 1.0
&gt;&gt;&gt; v1 = numpy.random.random(3) - 0.5
&gt;&gt;&gt; R = reflection_matrix(v0, v1)
&gt;&gt;&gt; numpy.allclose(2., numpy.trace(R))
True
&gt;&gt;&gt; numpy.allclose(v0, numpy.dot(R, v0))
True
&gt;&gt;&gt; v2 = v0.copy()
&gt;&gt;&gt; v2[:3] += v1
&gt;&gt;&gt; v3 = v0.copy()
&gt;&gt;&gt; v2[:3] -= v1
&gt;&gt;&gt; numpy.allclose(v2, numpy.dot(R, v3))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="220" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="220" bodyend="245"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1aceb13a95688b97f6f1dba9bc5c08c18e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.reflection_from_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>reflection_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return mirror plane point and normal vector from reflection matrix.

&gt;&gt;&gt; v0 = numpy.random.random(3) - 0.5
&gt;&gt;&gt; v1 = numpy.random.random(3) - 0.5
&gt;&gt;&gt; M0 = reflection_matrix(v0, v1)
&gt;&gt;&gt; point, normal = reflection_from_matrix(M0)
&gt;&gt;&gt; M1 = reflection_matrix(point, normal)
&gt;&gt;&gt; is_same_transform(M0, M1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="246" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="246" bodyend="274"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1abc7e6dd1fd132816083ac3428b8a69b6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.rotation_matrix</definition>
        <argsstring>(angle, direction, point=None)</argsstring>
        <name>rotation_matrix</name>
        <param>
          <type>angle</type>
          <defname>angle</defname>
        </param>
        <param>
          <type>direction</type>
          <defname>direction</defname>
        </param>
        <param>
          <type>point</type>
          <defname>point</defname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to rotate about axis defined by point and direction.

&gt;&gt;&gt; angle = (random.random() - 0.5) * (2*math.pi)
&gt;&gt;&gt; direc = numpy.random.random(3) - 0.5
&gt;&gt;&gt; point = numpy.random.random(3) - 0.5
&gt;&gt;&gt; R0 = rotation_matrix(angle, direc, point)
&gt;&gt;&gt; R1 = rotation_matrix(angle-2*math.pi, direc, point)
&gt;&gt;&gt; is_same_transform(R0, R1)
True
&gt;&gt;&gt; R0 = rotation_matrix(angle, direc, point)
&gt;&gt;&gt; R1 = rotation_matrix(-angle, -direc, point)
&gt;&gt;&gt; is_same_transform(R0, R1)
True
&gt;&gt;&gt; I = numpy.identity(4, numpy.float64)
&gt;&gt;&gt; numpy.allclose(I, rotation_matrix(math.pi*2, direc))
True
&gt;&gt;&gt; numpy.allclose(2., numpy.trace(rotation_matrix(math.pi/2,
...                                                direc, point)))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="275" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="275" bodyend="318"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1aaeb471e12c3ec3b54e508a6c22ffd46c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.rotation_from_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>rotation_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return rotation angle and axis from rotation matrix.

&gt;&gt;&gt; angle = (random.random() - 0.5) * (2*math.pi)
&gt;&gt;&gt; direc = numpy.random.random(3) - 0.5
&gt;&gt;&gt; point = numpy.random.random(3) - 0.5
&gt;&gt;&gt; R0 = rotation_matrix(angle, direc, point)
&gt;&gt;&gt; angle, direc, point = rotation_from_matrix(R0)
&gt;&gt;&gt; R1 = rotation_matrix(angle, direc, point)
&gt;&gt;&gt; is_same_transform(R0, R1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="319" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="319" bodyend="358"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a9f9c41cbb1f45fd91b50bb50300bcde9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.scale_matrix</definition>
        <argsstring>(factor, origin=None, direction=None)</argsstring>
        <name>scale_matrix</name>
        <param>
          <type>factor</type>
          <defname>factor</defname>
        </param>
        <param>
          <type>origin</type>
          <defname>origin</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>direction</type>
          <defname>direction</defname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to scale by factor around origin in direction.

Use factor -1 for point symmetry.

&gt;&gt;&gt; v = (numpy.random.rand(4, 5) - 0.5) * 20.0
&gt;&gt;&gt; v[3] = 1.0
&gt;&gt;&gt; S = scale_matrix(-1.234)
&gt;&gt;&gt; numpy.allclose(numpy.dot(S, v)[:3], -1.234*v[:3])
True
&gt;&gt;&gt; factor = random.random() * 10 - 5
&gt;&gt;&gt; origin = numpy.random.random(3) - 0.5
&gt;&gt;&gt; direct = numpy.random.random(3) - 0.5
&gt;&gt;&gt; S = scale_matrix(factor, origin)
&gt;&gt;&gt; S = scale_matrix(factor, origin, direct)</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="359" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="359" bodyend="395"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a6c59458c4346180a260d955564770070" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.scale_from_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>scale_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return scaling factor, origin and direction from scaling matrix.

&gt;&gt;&gt; factor = random.random() * 10 - 5
&gt;&gt;&gt; origin = numpy.random.random(3) - 0.5
&gt;&gt;&gt; direct = numpy.random.random(3) - 0.5
&gt;&gt;&gt; S0 = scale_matrix(factor, origin)
&gt;&gt;&gt; factor, origin, direction = scale_from_matrix(S0)
&gt;&gt;&gt; S1 = scale_matrix(factor, origin, direction)
&gt;&gt;&gt; is_same_transform(S0, S1)
True
&gt;&gt;&gt; S0 = scale_matrix(factor, origin, direct)
&gt;&gt;&gt; factor, origin, direction = scale_from_matrix(S0)
&gt;&gt;&gt; S1 = scale_matrix(factor, origin, direction)
&gt;&gt;&gt; is_same_transform(S0, S1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="396" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="396" bodyend="436"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1abc5f035f1804af5c2836d8cec8a9d61b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.projection_matrix</definition>
        <argsstring>(point, normal, direction=None, perspective=None, pseudo=False)</argsstring>
        <name>projection_matrix</name>
        <param>
          <type>point</type>
          <defname>point</defname>
        </param>
        <param>
          <type>normal</type>
          <defname>normal</defname>
        </param>
        <param>
          <type>direction</type>
          <defname>direction</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>perspective</type>
          <defname>perspective</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>pseudo</type>
          <defname>pseudo</defname>
          <defval>False</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to project onto plane defined by point and normal.

Using either perspective point, projection direction, or none of both.

If pseudo is True, perspective projections will preserve relative depth
such that Perspective = dot(Orthogonal, PseudoPerspective).

&gt;&gt;&gt; P = projection_matrix((0, 0, 0), (1, 0, 0))
&gt;&gt;&gt; numpy.allclose(P[1:, 1:], numpy.identity(4)[1:, 1:])
True
&gt;&gt;&gt; point = numpy.random.random(3) - 0.5
&gt;&gt;&gt; normal = numpy.random.random(3) - 0.5
&gt;&gt;&gt; direct = numpy.random.random(3) - 0.5
&gt;&gt;&gt; persp = numpy.random.random(3) - 0.5
&gt;&gt;&gt; P0 = projection_matrix(point, normal)
&gt;&gt;&gt; P1 = projection_matrix(point, normal, direction=direct)
&gt;&gt;&gt; P2 = projection_matrix(point, normal, perspective=persp)
&gt;&gt;&gt; P3 = projection_matrix(point, normal, perspective=persp, pseudo=True)
&gt;&gt;&gt; is_same_transform(P2, numpy.dot(P0, P3))
True
&gt;&gt;&gt; P = projection_matrix((3, 0, 0), (1, 1, 0), (1, 0, 0))
&gt;&gt;&gt; v0 = (numpy.random.rand(4, 5) - 0.5) * 20.0
&gt;&gt;&gt; v0[3] = 1.0
&gt;&gt;&gt; v1 = numpy.dot(P, v0)
&gt;&gt;&gt; numpy.allclose(v1[1], v0[1])
True
&gt;&gt;&gt; numpy.allclose(v1[0], 3.0-v1[1])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="437" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="437" bodyend="498"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1acba3493f821ded8dea8e22fa73a979dc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.projection_from_matrix</definition>
        <argsstring>(matrix, pseudo=False)</argsstring>
        <name>projection_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <param>
          <type>pseudo</type>
          <defname>pseudo</defname>
          <defval>False</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return projection plane and perspective point from projection matrix.

Return values are same as arguments for projection_matrix function:
point, normal, direction, perspective, and pseudo.

&gt;&gt;&gt; point = numpy.random.random(3) - 0.5
&gt;&gt;&gt; normal = numpy.random.random(3) - 0.5
&gt;&gt;&gt; direct = numpy.random.random(3) - 0.5
&gt;&gt;&gt; persp = numpy.random.random(3) - 0.5
&gt;&gt;&gt; P0 = projection_matrix(point, normal)
&gt;&gt;&gt; result = projection_from_matrix(P0)
&gt;&gt;&gt; P1 = projection_matrix(*result)
&gt;&gt;&gt; is_same_transform(P0, P1)
True
&gt;&gt;&gt; P0 = projection_matrix(point, normal, direct)
&gt;&gt;&gt; result = projection_from_matrix(P0)
&gt;&gt;&gt; P1 = projection_matrix(*result)
&gt;&gt;&gt; is_same_transform(P0, P1)
True
&gt;&gt;&gt; P0 = projection_matrix(point, normal, perspective=persp, pseudo=False)
&gt;&gt;&gt; result = projection_from_matrix(P0, pseudo=False)
&gt;&gt;&gt; P1 = projection_matrix(*result)
&gt;&gt;&gt; is_same_transform(P0, P1)
True
&gt;&gt;&gt; P0 = projection_matrix(point, normal, perspective=persp, pseudo=True)
&gt;&gt;&gt; result = projection_from_matrix(P0, pseudo=True)
&gt;&gt;&gt; P1 = projection_matrix(*result)
&gt;&gt;&gt; is_same_transform(P0, P1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="499" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="499" bodyend="571"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a3172f76374952e85851ddcd58e6dfaf4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.clip_matrix</definition>
        <argsstring>(left, right, bottom, top, near, far, perspective=False)</argsstring>
        <name>clip_matrix</name>
        <param>
          <type>left</type>
          <defname>left</defname>
        </param>
        <param>
          <type>right</type>
          <defname>right</defname>
        </param>
        <param>
          <type>bottom</type>
          <defname>bottom</defname>
        </param>
        <param>
          <type>top</type>
          <defname>top</defname>
        </param>
        <param>
          <type>near</type>
          <defname>near</defname>
        </param>
        <param>
          <type>far</type>
          <defname>far</defname>
        </param>
        <param>
          <type>perspective</type>
          <defname>perspective</defname>
          <defval>False</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to obtain normalized device coordinates from frustrum.

The frustrum bounds are axis-aligned along x (left, right),
y (bottom, top) and z (near, far).

Normalized device coordinates are in range [-1, 1] if coordinates are
inside the frustrum.

If perspective is True the frustrum is a truncated pyramid with the
perspective point at origin and direction along z axis, otherwise an
orthographic canonical view volume (a box).

Homogeneous coordinates transformed by the perspective clip matrix
need to be dehomogenized (devided by w coordinate).

&gt;&gt;&gt; frustrum = numpy.random.rand(6)
&gt;&gt;&gt; frustrum[1] += frustrum[0]
&gt;&gt;&gt; frustrum[3] += frustrum[2]
&gt;&gt;&gt; frustrum[5] += frustrum[4]
&gt;&gt;&gt; M = clip_matrix(*frustrum, perspective=False)
&gt;&gt;&gt; numpy.dot(M, [frustrum[0], frustrum[2], frustrum[4], 1.0])
array([-1., -1., -1.,  1.])
&gt;&gt;&gt; numpy.dot(M, [frustrum[1], frustrum[3], frustrum[5], 1.0])
array([ 1.,  1.,  1.,  1.])
&gt;&gt;&gt; M = clip_matrix(*frustrum, perspective=True)
&gt;&gt;&gt; v = numpy.dot(M, [frustrum[0], frustrum[2], frustrum[4], 1.0])
&gt;&gt;&gt; v / v[3]
array([-1., -1., -1.,  1.])
&gt;&gt;&gt; v = numpy.dot(M, [frustrum[1], frustrum[3], frustrum[4], 1.0])
&gt;&gt;&gt; v / v[3]
array([ 1.,  1., -1.,  1.])</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="572" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="572" bodyend="623"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1ae0ee96fd2d288b16425589ba6726f44c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.shear_matrix</definition>
        <argsstring>(angle, direction, point, normal)</argsstring>
        <name>shear_matrix</name>
        <param>
          <type>angle</type>
          <defname>angle</defname>
        </param>
        <param>
          <type>direction</type>
          <defname>direction</defname>
        </param>
        <param>
          <type>point</type>
          <defname>point</defname>
        </param>
        <param>
          <type>normal</type>
          <defname>normal</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to shear by angle along direction vector on shear plane.

The shear plane is defined by a point and normal vector. The direction
vector must be orthogonal to the plane&apos;s normal vector.

A point P is transformed by the shear matrix into P&quot; such that
the vector P-P&quot; is parallel to the direction vector and its extent is
given by the angle of P-P&apos;-P&quot;, where P&apos; is the orthogonal projection
of P onto the shear plane.

&gt;&gt;&gt; angle = (random.random() - 0.5) * 4*math.pi
&gt;&gt;&gt; direct = numpy.random.random(3) - 0.5
&gt;&gt;&gt; point = numpy.random.random(3) - 0.5
&gt;&gt;&gt; normal = numpy.cross(direct, numpy.random.random(3))
&gt;&gt;&gt; S = shear_matrix(angle, direct, point, normal)
&gt;&gt;&gt; numpy.allclose(1.0, numpy.linalg.det(S))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="624" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="624" bodyend="654"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a383e045035fb4b9a25962b52f4e25c43" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.shear_from_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>shear_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return shear angle, direction and plane from shear matrix.

&gt;&gt;&gt; angle = (random.random() - 0.5) * 4*math.pi
&gt;&gt;&gt; direct = numpy.random.random(3) - 0.5
&gt;&gt;&gt; point = numpy.random.random(3) - 0.5
&gt;&gt;&gt; normal = numpy.cross(direct, numpy.random.random(3))
&gt;&gt;&gt; S0 = shear_matrix(angle, direct, point, normal)
&gt;&gt;&gt; angle, direct, point, normal = shear_from_matrix(S0)
&gt;&gt;&gt; S1 = shear_matrix(angle, direct, point, normal)
&gt;&gt;&gt; is_same_transform(S0, S1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="655" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="655" bodyend="699"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a550fa629e0d87f0889a45fbc50d7b188" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.decompose_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>decompose_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return sequence of transformations from transformation matrix.

matrix : array_like
    Non-degenerative homogeneous transformation matrix

Return tuple of:
    scale : vector of 3 scaling factors
    shear : list of shear factors for x-y, x-z, y-z axes
    angles : list of Euler angles about static x, y, z axes
    translate : translation vector along x, y, z axes
    perspective : perspective partition of matrix

Raise ValueError if matrix is of wrong type or degenerative.

&gt;&gt;&gt; T0 = translation_matrix((1, 2, 3))
&gt;&gt;&gt; scale, shear, angles, trans, persp = decompose_matrix(T0)
&gt;&gt;&gt; T1 = translation_matrix(trans)
&gt;&gt;&gt; numpy.allclose(T0, T1)
True
&gt;&gt;&gt; S = scale_matrix(0.123)
&gt;&gt;&gt; scale, shear, angles, trans, persp = decompose_matrix(S)
&gt;&gt;&gt; scale[0]
0.123
&gt;&gt;&gt; R0 = euler_matrix(1, 2, 3)
&gt;&gt;&gt; scale, shear, angles, trans, persp = decompose_matrix(R0)
&gt;&gt;&gt; R1 = euler_matrix(*angles)
&gt;&gt;&gt; numpy.allclose(R0, R1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="700" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="700" bodyend="784"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a863b70b2670453bdd6b826122675265e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.compose_matrix</definition>
        <argsstring>(scale=None, shear=None, angles=None, translate=None, perspective=None)</argsstring>
        <name>compose_matrix</name>
        <param>
          <type>scale</type>
          <defname>scale</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>shear</type>
          <defname>shear</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>angles</type>
          <defname>angles</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>translate</type>
          <defname>translate</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>perspective</type>
          <defname>perspective</defname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return transformation matrix from sequence of transformations.

This is the inverse of the decompose_matrix function.

Sequence of transformations:
    scale : vector of 3 scaling factors
    shear : list of shear factors for x-y, x-z, y-z axes
    angles : list of Euler angles about static x, y, z axes
    translate : translation vector along x, y, z axes
    perspective : perspective partition of matrix

&gt;&gt;&gt; scale = numpy.random.random(3) - 0.5
&gt;&gt;&gt; shear = numpy.random.random(3) - 0.5
&gt;&gt;&gt; angles = (numpy.random.random(3) - 0.5) * (2*math.pi)
&gt;&gt;&gt; trans = numpy.random.random(3) - 0.5
&gt;&gt;&gt; persp = numpy.random.random(4) - 0.5
&gt;&gt;&gt; M0 = compose_matrix(scale, shear, angles, trans, persp)
&gt;&gt;&gt; result = decompose_matrix(M0)
&gt;&gt;&gt; M1 = compose_matrix(*result)
&gt;&gt;&gt; is_same_transform(M0, M1)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="785" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="785" bodyend="837"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1aca261660a4ec7d31fff1815f272e057a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.orthogonalization_matrix</definition>
        <argsstring>(lengths, angles)</argsstring>
        <name>orthogonalization_matrix</name>
        <param>
          <type>lengths</type>
          <defname>lengths</defname>
        </param>
        <param>
          <type>angles</type>
          <defname>angles</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return orthogonalization matrix for crystallographic cell coordinates.

Angles are expected in degrees.

The de-orthogonalization matrix is the inverse.

&gt;&gt;&gt; O = orthogonalization_matrix((10., 10., 10.), (90., 90., 90.))
&gt;&gt;&gt; numpy.allclose(O[:3, :3], numpy.identity(3, float) * 10)
True
&gt;&gt;&gt; O = orthogonalization_matrix([9.8, 12.0, 15.5], [87.2, 80.7, 69.7])
&gt;&gt;&gt; numpy.allclose(numpy.sum(O), 43.063229)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="838" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="838" bodyend="865"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1ab7c794efa1f22053d9c2b9ed84fee5dc" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.superimposition_matrix</definition>
        <argsstring>(v0, v1, scaling=False, usesvd=True)</argsstring>
        <name>superimposition_matrix</name>
        <param>
          <type>v0</type>
          <defname>v0</defname>
        </param>
        <param>
          <type>v1</type>
          <defname>v1</defname>
        </param>
        <param>
          <type>scaling</type>
          <defname>scaling</defname>
          <defval>False</defval>
        </param>
        <param>
          <type>usesvd</type>
          <defname>usesvd</defname>
          <defval>True</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return matrix to transform given vector set into second vector set.

v0 and v1 are shape (3, \*) or (4, \*) arrays of at least 3 vectors.

If usesvd is True, the weighted sum of squared deviations (RMSD) is
minimized according to the algorithm by W. Kabsch [8]. Otherwise the
quaternion based algorithm by B. Horn [9] is used (slower when using
this Python implementation).

The returned matrix performs rotation, translation and uniform scaling
(if specified).

&gt;&gt;&gt; v0 = numpy.random.rand(3, 10)
&gt;&gt;&gt; M = superimposition_matrix(v0, v0)
&gt;&gt;&gt; numpy.allclose(M, numpy.identity(4))
True
&gt;&gt;&gt; R = random_rotation_matrix(numpy.random.random(3))
&gt;&gt;&gt; v0 = ((1,0,0), (0,1,0), (0,0,1), (1,1,1))
&gt;&gt;&gt; v1 = numpy.dot(R, v0)
&gt;&gt;&gt; M = superimposition_matrix(v0, v1)
&gt;&gt;&gt; numpy.allclose(v1, numpy.dot(M, v0))
True
&gt;&gt;&gt; v0 = (numpy.random.rand(4, 100) - 0.5) * 20.0
&gt;&gt;&gt; v0[3] = 1.0
&gt;&gt;&gt; v1 = numpy.dot(R, v0)
&gt;&gt;&gt; M = superimposition_matrix(v0, v1)
&gt;&gt;&gt; numpy.allclose(v1, numpy.dot(M, v0))
True
&gt;&gt;&gt; S = scale_matrix(random.random())
&gt;&gt;&gt; T = translation_matrix(numpy.random.random(3)-0.5)
&gt;&gt;&gt; M = concatenate_matrices(T, R, S)
&gt;&gt;&gt; v1 = numpy.dot(M, v0)
&gt;&gt;&gt; v0[:3] += numpy.random.normal(0.0, 1e-9, 300).reshape(3, -1)
&gt;&gt;&gt; M = superimposition_matrix(v0, v1, scaling=True)
&gt;&gt;&gt; numpy.allclose(v1, numpy.dot(M, v0))
True
&gt;&gt;&gt; M = superimposition_matrix(v0, v1, scaling=True, usesvd=False)
&gt;&gt;&gt; numpy.allclose(v1, numpy.dot(M, v0))
True
&gt;&gt;&gt; v = numpy.empty((4, 100, 3), dtype=numpy.float64)
&gt;&gt;&gt; v[:, :, 0] = v0
&gt;&gt;&gt; M = superimposition_matrix(v0, v1, scaling=True, usesvd=False)
&gt;&gt;&gt; numpy.allclose(v1, numpy.dot(M, v[:, :, 0]))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="866" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="866" bodyend="967"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a5c046126e0cbc8f2da3a5d07aeb39d2d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.euler_matrix</definition>
        <argsstring>(ai, aj, ak, axes=&apos;sxyz&apos;)</argsstring>
        <name>euler_matrix</name>
        <param>
          <type>ai</type>
          <defname>ai</defname>
        </param>
        <param>
          <type>aj</type>
          <defname>aj</defname>
        </param>
        <param>
          <type>ak</type>
          <defname>ak</defname>
        </param>
        <param>
          <type>axes</type>
          <defname>axes</defname>
          <defval>&apos;sxyz&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return homogeneous rotation matrix from Euler angles and axis sequence.

ai, aj, ak : Euler&apos;s roll, pitch and yaw angles
axes : One of 24 axis sequences as string or encoded tuple

&gt;&gt;&gt; R = euler_matrix(1, 2, 3, &apos;syxz&apos;)
&gt;&gt;&gt; numpy.allclose(numpy.sum(R[0]), -1.34786452)
True
&gt;&gt;&gt; R = euler_matrix(1, 2, 3, (0, 1, 0, 1))
&gt;&gt;&gt; numpy.allclose(numpy.sum(R[0]), -0.383436184)
True
&gt;&gt;&gt; ai, aj, ak = (4.0*math.pi) * (numpy.random.random(3) - 0.5)
&gt;&gt;&gt; for axes in _AXES2TUPLE.keys():
...    R = euler_matrix(ai, aj, ak, axes)
&gt;&gt;&gt; for axes in _TUPLE2AXES.keys():
...    R = euler_matrix(ai, aj, ak, axes)</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="968" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="968" bodyend="1030"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a1b492d74b08953c2e821b7bb33137e95" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.euler_from_matrix</definition>
        <argsstring>(matrix, axes=&apos;sxyz&apos;)</argsstring>
        <name>euler_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <param>
          <type>axes</type>
          <defname>axes</defname>
          <defval>&apos;sxyz&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return Euler angles from rotation matrix for specified axis sequence.

axes : One of 24 axis sequences as string or encoded tuple

Note that many Euler angle triplets can describe one matrix.

&gt;&gt;&gt; R0 = euler_matrix(1, 2, 3, &apos;syxz&apos;)
&gt;&gt;&gt; al, be, ga = euler_from_matrix(R0, &apos;syxz&apos;)
&gt;&gt;&gt; R1 = euler_matrix(al, be, ga, &apos;syxz&apos;)
&gt;&gt;&gt; numpy.allclose(R0, R1)
True
&gt;&gt;&gt; angles = (4.0*math.pi) * (numpy.random.random(3) - 0.5)
&gt;&gt;&gt; for axes in _AXES2TUPLE.keys():
...    R0 = euler_matrix(axes=axes, *angles)
...    R1 = euler_matrix(axes=axes, *euler_from_matrix(R0, axes))
...    if not numpy.allclose(R0, R1): print axes, &quot;failed&quot;</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1031" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1031" bodyend="1088"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a647d42e9806bfb441de2dc184d03ee3c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.euler_from_quaternion</definition>
        <argsstring>(quaternion, axes=&apos;sxyz&apos;)</argsstring>
        <name>euler_from_quaternion</name>
        <param>
          <type>quaternion</type>
          <defname>quaternion</defname>
        </param>
        <param>
          <type>axes</type>
          <defname>axes</defname>
          <defval>&apos;sxyz&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return Euler angles from quaternion for specified axis sequence.

&gt;&gt;&gt; angles = euler_from_quaternion([0.06146124, 0, 0, 0.99810947])
&gt;&gt;&gt; numpy.allclose(angles, [0.123, 0, 0])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1089" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1089" bodyend="1099"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1adb8a5dd06da77f1d19d558989cbc3fdd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_from_euler</definition>
        <argsstring>(ai, aj, ak, axes=&apos;sxyz&apos;)</argsstring>
        <name>quaternion_from_euler</name>
        <param>
          <type>ai</type>
          <defname>ai</defname>
        </param>
        <param>
          <type>aj</type>
          <defname>aj</defname>
        </param>
        <param>
          <type>ak</type>
          <defname>ak</defname>
        </param>
        <param>
          <type>axes</type>
          <defname>axes</defname>
          <defval>&apos;sxyz&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return quaternion from Euler angles and axis sequence.

ai, aj, ak : Euler&apos;s roll, pitch and yaw angles
axes : One of 24 axis sequences as string or encoded tuple

&gt;&gt;&gt; q = quaternion_from_euler(1, 2, 3, &apos;ryxz&apos;)
&gt;&gt;&gt; numpy.allclose(q, [0.310622, -0.718287, 0.444435, 0.435953])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1100" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1100" bodyend="1156"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a78f59ddfe9567599b9494ffd29a350c1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_about_axis</definition>
        <argsstring>(angle, axis)</argsstring>
        <name>quaternion_about_axis</name>
        <param>
          <type>angle</type>
          <defname>angle</defname>
        </param>
        <param>
          <type>axis</type>
          <defname>axis</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return quaternion for rotation about axis.

&gt;&gt;&gt; q = quaternion_about_axis(0.123, (1, 0, 0))
&gt;&gt;&gt; numpy.allclose(q, [0.06146124, 0, 0, 0.99810947])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1157" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1157" bodyend="1173"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1ac170aed6f2003d0d8206940f4bde5291" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_matrix</definition>
        <argsstring>(quaternion)</argsstring>
        <name>quaternion_matrix</name>
        <param>
          <type>quaternion</type>
          <defname>quaternion</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return homogeneous rotation matrix from quaternion.

&gt;&gt;&gt; R = quaternion_matrix([0.06146124, 0, 0, 0.99810947])
&gt;&gt;&gt; numpy.allclose(R, rotation_matrix(0.123, (1, 0, 0)))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1174" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1174" bodyend="1195"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a40037a8e565b0243eefb03ae416e9784" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_from_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>quaternion_from_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return quaternion from rotation matrix.

&gt;&gt;&gt; R = rotation_matrix(0.123, (1, 2, 3))
&gt;&gt;&gt; q = quaternion_from_matrix(R)
&gt;&gt;&gt; numpy.allclose(q, [0.0164262, 0.0328524, 0.0492786, 0.9981095])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1196" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1196" bodyend="1227"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a8412bbeec08fdd07d7c48b1a47f6896c" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_multiply</definition>
        <argsstring>(quaternion1, quaternion0)</argsstring>
        <name>quaternion_multiply</name>
        <param>
          <type>quaternion1</type>
          <defname>quaternion1</defname>
        </param>
        <param>
          <type>quaternion0</type>
          <defname>quaternion0</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return multiplication of two quaternions.

&gt;&gt;&gt; q = quaternion_multiply([1, -2, 3, 4], [-5, 6, 7, 8])
&gt;&gt;&gt; numpy.allclose(q, [-44, -14, 48, 28])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1228" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1228" bodyend="1244"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a73655cff53941b7dd174d373c14817eb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_conjugate</definition>
        <argsstring>(quaternion)</argsstring>
        <name>quaternion_conjugate</name>
        <param>
          <type>quaternion</type>
          <defname>quaternion</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return conjugate of quaternion.

&gt;&gt;&gt; q0 = random_quaternion()
&gt;&gt;&gt; q1 = quaternion_conjugate(q0)
&gt;&gt;&gt; q1[3] == q0[3] and all(q1[:3] == -q0[:3])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1245" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1245" bodyend="1257"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a4bc632e877fa688fdbb7c2efde05d517" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_inverse</definition>
        <argsstring>(quaternion)</argsstring>
        <name>quaternion_inverse</name>
        <param>
          <type>quaternion</type>
          <defname>quaternion</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return inverse of quaternion.

&gt;&gt;&gt; q0 = random_quaternion()
&gt;&gt;&gt; q1 = quaternion_inverse(q0)
&gt;&gt;&gt; numpy.allclose(quaternion_multiply(q0, q1), [0, 0, 0, 1])
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1258" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1258" bodyend="1269"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a61ec085d5aacaeb3ce13f630963ef1ed" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.quaternion_slerp</definition>
        <argsstring>(quat0, quat1, fraction, spin=0, shortestpath=True)</argsstring>
        <name>quaternion_slerp</name>
        <param>
          <type>quat0</type>
          <defname>quat0</defname>
        </param>
        <param>
          <type>quat1</type>
          <defname>quat1</defname>
        </param>
        <param>
          <type>fraction</type>
          <defname>fraction</defname>
        </param>
        <param>
          <type>spin</type>
          <defname>spin</defname>
          <defval>0</defval>
        </param>
        <param>
          <type>shortestpath</type>
          <defname>shortestpath</defname>
          <defval>True</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return spherical linear interpolation between two quaternions.

&gt;&gt;&gt; q0 = random_quaternion()
&gt;&gt;&gt; q1 = random_quaternion()
&gt;&gt;&gt; q = quaternion_slerp(q0, q1, 0.0)
&gt;&gt;&gt; numpy.allclose(q, q0)
True
&gt;&gt;&gt; q = quaternion_slerp(q0, q1, 1.0, 1)
&gt;&gt;&gt; numpy.allclose(q, q1)
True
&gt;&gt;&gt; q = quaternion_slerp(q0, q1, 0.5)
&gt;&gt;&gt; angle = math.acos(numpy.dot(q0, q))
&gt;&gt;&gt; numpy.allclose(2.0, math.acos(numpy.dot(q0, q1)) / angle) or \
    numpy.allclose(2.0, math.acos(-numpy.dot(q0, q1)) / angle)
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1270" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1270" bodyend="1310"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a05e108e1db608b4603207bf5fef6acde" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.random_quaternion</definition>
        <argsstring>(rand=None)</argsstring>
        <name>random_quaternion</name>
        <param>
          <type>rand</type>
          <defname>rand</defname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return uniform random unit quaternion.

rand: array like or None
    Three independent random variables that are uniformly distributed
    between 0 and 1.

&gt;&gt;&gt; q = random_quaternion()
&gt;&gt;&gt; numpy.allclose(1.0, vector_norm(q))
True
&gt;&gt;&gt; q = random_quaternion(numpy.random.random(3))
&gt;&gt;&gt; q.shape
(4,)</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1311" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1311" bodyend="1340"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a5a4a89e9cd0468d67aab9ffcb2e38111" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.random_rotation_matrix</definition>
        <argsstring>(rand=None)</argsstring>
        <name>random_rotation_matrix</name>
        <param>
          <type>rand</type>
          <defname>rand</defname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return uniform random rotation matrix.

rnd: array like
    Three independent random variables that are uniformly distributed
    between 0 and 1 for each returned quaternion.

&gt;&gt;&gt; R = random_rotation_matrix()
&gt;&gt;&gt; numpy.allclose(numpy.dot(R.T, R), numpy.identity(4))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1341" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1341" bodyend="1355"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a68ac9633586d22e9aa43efe3f5e7b6db" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.arcball_map_to_sphere</definition>
        <argsstring>(point, center, radius)</argsstring>
        <name>arcball_map_to_sphere</name>
        <param>
          <type>point</type>
          <defname>point</defname>
        </param>
        <param>
          <type>center</type>
          <defname>center</defname>
        </param>
        <param>
          <type>radius</type>
          <defname>radius</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return unit sphere coordinates from window coordinates.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1472" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1472" bodyend="1484"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a3d4007f9a3d05ced25c10c65f612aae3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.arcball_constrain_to_axis</definition>
        <argsstring>(point, axis)</argsstring>
        <name>arcball_constrain_to_axis</name>
        <param>
          <type>point</type>
          <defname>point</defname>
        </param>
        <param>
          <type>axis</type>
          <defname>axis</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return sphere point perpendicular to axis.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1485" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1485" bodyend="1500"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a568dde02ef0503be0dccc33c51377386" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.arcball_nearest_axis</definition>
        <argsstring>(point, axes)</argsstring>
        <name>arcball_nearest_axis</name>
        <param>
          <type>point</type>
          <defname>point</defname>
        </param>
        <param>
          <type>axes</type>
          <defname>axes</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return axis, which arc is nearest to point.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1501" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1501" bodyend="1514"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a5889ee689ebc692689d5aee4e65894ff" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.vector_norm</definition>
        <argsstring>(data, axis=None, out=None)</argsstring>
        <name>vector_norm</name>
        <param>
          <type>data</type>
          <defname>data</defname>
        </param>
        <param>
          <type>axis</type>
          <defname>axis</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>out</type>
          <defname>out</defname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return length, i.e. eucledian norm, of ndarray along axis.

&gt;&gt;&gt; v = numpy.random.random(3)
&gt;&gt;&gt; n = vector_norm(v)
&gt;&gt;&gt; numpy.allclose(n, numpy.linalg.norm(v))
True
&gt;&gt;&gt; v = numpy.random.rand(6, 5, 3)
&gt;&gt;&gt; n = vector_norm(v, axis=-1)
&gt;&gt;&gt; numpy.allclose(n, numpy.sqrt(numpy.sum(v*v, axis=2)))
True
&gt;&gt;&gt; n = vector_norm(v, axis=1)
&gt;&gt;&gt; numpy.allclose(n, numpy.sqrt(numpy.sum(v*v, axis=1)))
True
&gt;&gt;&gt; v = numpy.random.rand(5, 4, 3)
&gt;&gt;&gt; n = numpy.empty((5, 3), dtype=numpy.float64)
&gt;&gt;&gt; vector_norm(v, axis=1, out=n)
&gt;&gt;&gt; numpy.allclose(n, numpy.sqrt(numpy.sum(v*v, axis=1)))
True
&gt;&gt;&gt; vector_norm([])
0.0
&gt;&gt;&gt; vector_norm([1.0])
1.0</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1535" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1535" bodyend="1573"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a293fa487fec0f1da974f3abd9db338f2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.unit_vector</definition>
        <argsstring>(data, axis=None, out=None)</argsstring>
        <name>unit_vector</name>
        <param>
          <type>data</type>
          <defname>data</defname>
        </param>
        <param>
          <type>axis</type>
          <defname>axis</defname>
          <defval>None</defval>
        </param>
        <param>
          <type>out</type>
          <defname>out</defname>
          <defval>None</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return ndarray normalized by length, i.e. eucledian norm, along axis.

&gt;&gt;&gt; v0 = numpy.random.random(3)
&gt;&gt;&gt; v1 = unit_vector(v0)
&gt;&gt;&gt; numpy.allclose(v1, v0 / numpy.linalg.norm(v0))
True
&gt;&gt;&gt; v0 = numpy.random.rand(5, 4, 3)
&gt;&gt;&gt; v1 = unit_vector(v0, axis=-1)
&gt;&gt;&gt; v2 = v0 / numpy.expand_dims(numpy.sqrt(numpy.sum(v0*v0, axis=2)), 2)
&gt;&gt;&gt; numpy.allclose(v1, v2)
True
&gt;&gt;&gt; v1 = unit_vector(v0, axis=1)
&gt;&gt;&gt; v2 = v0 / numpy.expand_dims(numpy.sqrt(numpy.sum(v0*v0, axis=1)), 1)
&gt;&gt;&gt; numpy.allclose(v1, v2)
True
&gt;&gt;&gt; v1 = numpy.empty((5, 4, 3), dtype=numpy.float64)
&gt;&gt;&gt; unit_vector(v0, axis=1, out=v1)
&gt;&gt;&gt; numpy.allclose(v1, v2)
True
&gt;&gt;&gt; list(unit_vector([]))
[]
&gt;&gt;&gt; list(unit_vector([1.0]))
[1.0]</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1574" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1574" bodyend="1617"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a88041497124f1de6cc2732a740fe9c40" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.random_vector</definition>
        <argsstring>(size)</argsstring>
        <name>random_vector</name>
        <param>
          <type>size</type>
          <defname>size</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return array of random doubles in the half-open interval [0.0, 1.0).

&gt;&gt;&gt; v = random_vector(10000)
&gt;&gt;&gt; numpy.all(v &gt;= 0.0) and numpy.all(v &lt; 1.0)
True
&gt;&gt;&gt; v0 = random_vector(10)
&gt;&gt;&gt; v1 = random_vector(10)
&gt;&gt;&gt; numpy.any(v0 == v1)
False</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1618" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1618" bodyend="1632"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1aaec4eed41c25944bbe6ee60474d76de2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.inverse_matrix</definition>
        <argsstring>(matrix)</argsstring>
        <name>inverse_matrix</name>
        <param>
          <type>matrix</type>
          <defname>matrix</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return inverse of square transformation matrix.

&gt;&gt;&gt; M0 = random_rotation_matrix()
&gt;&gt;&gt; M1 = inverse_matrix(M0.T)
&gt;&gt;&gt; numpy.allclose(M1, numpy.linalg.inv(M0.T))
True
&gt;&gt;&gt; for size in range(1, 7):
...     M0 = numpy.random.rand(size, size)
...     M1 = inverse_matrix(M0)
...     if not numpy.allclose(M1, numpy.linalg.inv(M0)): print size</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1633" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1633" bodyend="1648"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a38b5284fea916d3bcf541510b485b5c1" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.concatenate_matrices</definition>
        <argsstring>(*matrices)</argsstring>
        <name>concatenate_matrices</name>
        <param>
          <type>*</type>
          <declname>matrices</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return concatenation of series of transformation matrices.

&gt;&gt;&gt; M = numpy.random.rand(16).reshape((4, 4)) - 0.5
&gt;&gt;&gt; numpy.allclose(M, concatenate_matrices(M))
True
&gt;&gt;&gt; numpy.allclose(numpy.dot(M, M.T), concatenate_matrices(M, M.T))
True</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1649" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1649" bodyend="1664"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a95289fd1bc1dab7bffa6ec0211012daa" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations.is_same_transform</definition>
        <argsstring>(matrix0, matrix1)</argsstring>
        <name>is_same_transform</name>
        <param>
          <type>matrix0</type>
          <defname>matrix0</defname>
        </param>
        <param>
          <type>matrix1</type>
          <defname>matrix1</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Return True if two matrices perform same transformation.

&gt;&gt;&gt; is_same_transform(numpy.identity(4), numpy.identity(4))
True
&gt;&gt;&gt; is_same_transform(numpy.identity(4), random_rotation_matrix())
False</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1665" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1665" bodyend="1680"/>
      </memberdef>
      <memberdef kind="function" id="transformations_8py_1a40c1a45d26b42ef9823f1c1363127001" prot="private" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>def</type>
        <definition>def tf_quaternion.transformations._import_module</definition>
        <argsstring>(module_name, warn=True, prefix=&apos;_py_&apos;, ignore=&apos;_&apos;)</argsstring>
        <name>_import_module</name>
        <param>
          <type>module_name</type>
          <defname>module_name</defname>
        </param>
        <param>
          <type>warn</type>
          <defname>warn</defname>
          <defval>True</defval>
        </param>
        <param>
          <type>prefix</type>
          <defname>prefix</defname>
          <defval>&apos;_py_&apos;</defval>
        </param>
        <param>
          <type>ignore</type>
          <defname>ignore</defname>
          <defval>&apos;_&apos;</defval>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para><verbatim>Try import all public attributes from module into global namespace.

Existing attributes with name clashes are renamed with prefix.
Attributes starting with underscore are ignored by default.

Return True on successful import.</verbatim> </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/tf_quaternion/transformations.py" line="1681" column="1" bodyfile="src/tf_quaternion/transformations.py" bodystart="1681" bodyend="1706"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">#<sp/>-*-<sp/>coding:<sp/>utf-8<sp/>-*-</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#<sp/>transformations.py</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Copyright<sp/>(c)<sp/>2006,<sp/>Christoph<sp/>Gohlke</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Copyright<sp/>(c)<sp/>2006-2009,<sp/>The<sp/>Regents<sp/>of<sp/>the<sp/>University<sp/>of<sp/>California</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">#<sp/>All<sp/>rights<sp/>reserved.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Redistribution<sp/>and<sp/>use<sp/>in<sp/>source<sp/>and<sp/>binary<sp/>forms,<sp/>with<sp/>or<sp/>without</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">#<sp/>modification,<sp/>are<sp/>permitted<sp/>provided<sp/>that<sp/>the<sp/>following<sp/>conditions<sp/>are<sp/>met:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">#<sp/>*<sp/>Redistributions<sp/>of<sp/>source<sp/>code<sp/>must<sp/>retain<sp/>the<sp/>above<sp/>copyright</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">#<sp/>*<sp/>Redistributions<sp/>in<sp/>binary<sp/>form<sp/>must<sp/>reproduce<sp/>the<sp/>above<sp/>copyright</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/>notice,<sp/>this<sp/>list<sp/>of<sp/>conditions<sp/>and<sp/>the<sp/>following<sp/>disclaimer<sp/>in<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/>documentation<sp/>and/or<sp/>other<sp/>materials<sp/>provided<sp/>with<sp/>the<sp/>distribution.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">#<sp/>*<sp/>Neither<sp/>the<sp/>name<sp/>of<sp/>the<sp/>copyright<sp/>holders<sp/>nor<sp/>the<sp/>names<sp/>of<sp/>any</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/>contributors<sp/>may<sp/>be<sp/>used<sp/>to<sp/>endorse<sp/>or<sp/>promote<sp/>products<sp/>derived</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">#<sp/><sp/><sp/>from<sp/>this<sp/>software<sp/>without<sp/>specific<sp/>prior<sp/>written<sp/>permission.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="comment">#<sp/>THIS<sp/>SOFTWARE<sp/>IS<sp/>PROVIDED<sp/>BY<sp/>THE<sp/>COPYRIGHT<sp/>HOLDERS<sp/>AND<sp/>CONTRIBUTORS<sp/>&quot;AS<sp/>IS&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="comment">#<sp/>AND<sp/>ANY<sp/>EXPRESS<sp/>OR<sp/>IMPLIED<sp/>WARRANTIES,<sp/>INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>THE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="comment">#<sp/>IMPLIED<sp/>WARRANTIES<sp/>OF<sp/>MERCHANTABILITY<sp/>AND<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="comment">#<sp/>ARE<sp/>DISCLAIMED.<sp/><sp/>IN<sp/>NO<sp/>EVENT<sp/>SHALL<sp/>THE<sp/>COPYRIGHT<sp/>OWNER<sp/>OR<sp/>CONTRIBUTORS<sp/>BE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="comment">#<sp/>LIABLE<sp/>FOR<sp/>ANY<sp/>DIRECT,<sp/>INDIRECT,<sp/>INCIDENTAL,<sp/>SPECIAL,<sp/>EXEMPLARY,<sp/>OR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="comment">#<sp/>CONSEQUENTIAL<sp/>DAMAGES<sp/>(INCLUDING,<sp/>BUT<sp/>NOT<sp/>LIMITED<sp/>TO,<sp/>PROCUREMENT<sp/>OF</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="comment">#<sp/>SUBSTITUTE<sp/>GOODS<sp/>OR<sp/>SERVICES;<sp/>LOSS<sp/>OF<sp/>USE,<sp/>DATA,<sp/>OR<sp/>PROFITS;<sp/>OR<sp/>BUSINESS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="comment">#<sp/>INTERRUPTION)<sp/>HOWEVER<sp/>CAUSED<sp/>AND<sp/>ON<sp/>ANY<sp/>THEORY<sp/>OF<sp/>LIABILITY,<sp/>WHETHER<sp/>IN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="comment">#<sp/>CONTRACT,<sp/>STRICT<sp/>LIABILITY,<sp/>OR<sp/>TORT<sp/>(INCLUDING<sp/>NEGLIGENCE<sp/>OR<sp/>OTHERWISE)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="comment">#<sp/>ARISING<sp/>IN<sp/>ANY<sp/>WAY<sp/>OUT<sp/>OF<sp/>THE<sp/>USE<sp/>OF<sp/>THIS<sp/>SOFTWARE,<sp/>EVEN<sp/>IF<sp/>ADVISED<sp/>OF<sp/>THE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="comment">#<sp/>POSSIBILITY<sp/>OF<sp/>SUCH<sp/>DAMAGE.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;Homogeneous<sp/>Transformation<sp/>Matrices<sp/>and<sp/>Quaternions.</highlight></codeline>
<codeline lineno="33"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="34"><highlight class="stringliteral">A<sp/>library<sp/>for<sp/>calculating<sp/>4x4<sp/>matrices<sp/>for<sp/>translating,<sp/>rotating,<sp/>reflecting,</highlight></codeline>
<codeline lineno="35"><highlight class="stringliteral">scaling,<sp/>shearing,<sp/>projecting,<sp/>orthogonalizing,<sp/>and<sp/>superimposing<sp/>arrays<sp/>of</highlight></codeline>
<codeline lineno="36"><highlight class="stringliteral">3D<sp/>homogeneous<sp/>coordinates<sp/>as<sp/>well<sp/>as<sp/>for<sp/>converting<sp/>between<sp/>rotation<sp/>matrices,</highlight></codeline>
<codeline lineno="37"><highlight class="stringliteral">Euler<sp/>angles,<sp/>and<sp/>quaternions.<sp/>Also<sp/>includes<sp/>an<sp/>Arcball<sp/>control<sp/>object<sp/>and</highlight></codeline>
<codeline lineno="38"><highlight class="stringliteral">functions<sp/>to<sp/>decompose<sp/>transformation<sp/>matrices.</highlight></codeline>
<codeline lineno="39"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="40"><highlight class="stringliteral">:Authors:</highlight></codeline>
<codeline lineno="41"><highlight class="stringliteral"><sp/><sp/>`Christoph<sp/>Gohlke<sp/>&lt;http://www.lfd.uci.edu/~gohlke/&gt;`__,</highlight></codeline>
<codeline lineno="42"><highlight class="stringliteral"><sp/><sp/>Laboratory<sp/>for<sp/>Fluorescence<sp/>Dynamics,<sp/>University<sp/>of<sp/>California,<sp/>Irvine</highlight></codeline>
<codeline lineno="43"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="44"><highlight class="stringliteral">:Version:<sp/>20090418</highlight></codeline>
<codeline lineno="45"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="46"><highlight class="stringliteral">Requirements</highlight></codeline>
<codeline lineno="47"><highlight class="stringliteral">------------</highlight></codeline>
<codeline lineno="48"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="49"><highlight class="stringliteral">*<sp/>`Python<sp/>2.6<sp/>&lt;http://www.python.org&gt;`__</highlight></codeline>
<codeline lineno="50"><highlight class="stringliteral">*<sp/>`Numpy<sp/>1.3<sp/>&lt;http://numpy.scipy.org&gt;`__</highlight></codeline>
<codeline lineno="51"><highlight class="stringliteral">*<sp/>`transformations.c<sp/>20090418<sp/>&lt;http://www.lfd.uci.edu/~gohlke/&gt;`__</highlight></codeline>
<codeline lineno="52"><highlight class="stringliteral"><sp/><sp/>(optional<sp/>implementation<sp/>of<sp/>some<sp/>functions<sp/>in<sp/>C)</highlight></codeline>
<codeline lineno="53"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="54"><highlight class="stringliteral">Notes</highlight></codeline>
<codeline lineno="55"><highlight class="stringliteral">-----</highlight></codeline>
<codeline lineno="56"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="57"><highlight class="stringliteral">Matrices<sp/>(M)<sp/>can<sp/>be<sp/>inverted<sp/>using<sp/>numpy.linalg.inv(M),<sp/>concatenated<sp/>using</highlight></codeline>
<codeline lineno="58"><highlight class="stringliteral">numpy.dot(M0,<sp/>M1),<sp/>or<sp/>used<sp/>to<sp/>transform<sp/>homogeneous<sp/>coordinates<sp/>(v)<sp/>using</highlight></codeline>
<codeline lineno="59"><highlight class="stringliteral">numpy.dot(M,<sp/>v)<sp/>for<sp/>shape<sp/>(4,<sp/>\*)<sp/>&quot;point<sp/>of<sp/>arrays&quot;,<sp/>respectively</highlight></codeline>
<codeline lineno="60"><highlight class="stringliteral">numpy.dot(v,<sp/>M.T)<sp/>for<sp/>shape<sp/>(\*,<sp/>4)<sp/>&quot;array<sp/>of<sp/>points&quot;.</highlight></codeline>
<codeline lineno="61"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="62"><highlight class="stringliteral">Calculations<sp/>are<sp/>carried<sp/>out<sp/>with<sp/>numpy.float64<sp/>precision.</highlight></codeline>
<codeline lineno="63"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="64"><highlight class="stringliteral">This<sp/>Python<sp/>implementation<sp/>is<sp/>not<sp/>optimized<sp/>for<sp/>speed.</highlight></codeline>
<codeline lineno="65"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="66"><highlight class="stringliteral">Vector,<sp/>point,<sp/>quaternion,<sp/>and<sp/>matrix<sp/>function<sp/>arguments<sp/>are<sp/>expected<sp/>to<sp/>be</highlight></codeline>
<codeline lineno="67"><highlight class="stringliteral">&quot;array<sp/>like&quot;,<sp/>i.e.<sp/>tuple,<sp/>list,<sp/>or<sp/>numpy<sp/>arrays.</highlight></codeline>
<codeline lineno="68"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral">Return<sp/>types<sp/>are<sp/>numpy<sp/>arrays<sp/>unless<sp/>specified<sp/>otherwise.</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="71"><highlight class="stringliteral">Angles<sp/>are<sp/>in<sp/>radians<sp/>unless<sp/>specified<sp/>otherwise.</highlight></codeline>
<codeline lineno="72"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="73"><highlight class="stringliteral">Quaternions<sp/>ix+jy+kz+w<sp/>are<sp/>represented<sp/>as<sp/>[x,<sp/>y,<sp/>z,<sp/>w].</highlight></codeline>
<codeline lineno="74"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="75"><highlight class="stringliteral">Use<sp/>the<sp/>transpose<sp/>of<sp/>transformation<sp/>matrices<sp/>for<sp/>OpenGL<sp/>glMultMatrixd().</highlight></codeline>
<codeline lineno="76"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="77"><highlight class="stringliteral">A<sp/>triple<sp/>of<sp/>Euler<sp/>angles<sp/>can<sp/>be<sp/>applied/interpreted<sp/>in<sp/>24<sp/>ways,<sp/>which<sp/>can</highlight></codeline>
<codeline lineno="78"><highlight class="stringliteral">be<sp/>specified<sp/>using<sp/>a<sp/>4<sp/>character<sp/>string<sp/>or<sp/>encoded<sp/>4-tuple:</highlight></codeline>
<codeline lineno="79"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="80"><highlight class="stringliteral"><sp/><sp/>*Axes<sp/>4-string*:<sp/>e.g.<sp/>&apos;sxyz&apos;<sp/>or<sp/>&apos;ryxy&apos;</highlight></codeline>
<codeline lineno="81"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="82"><highlight class="stringliteral"><sp/><sp/>-<sp/>first<sp/>character<sp/>:<sp/>rotations<sp/>are<sp/>applied<sp/>to<sp/>&apos;s&apos;tatic<sp/>or<sp/>&apos;r&apos;otating<sp/>frame</highlight></codeline>
<codeline lineno="83"><highlight class="stringliteral"><sp/><sp/>-<sp/>remaining<sp/>characters<sp/>:<sp/>successive<sp/>rotation<sp/>axis<sp/>&apos;x&apos;,<sp/>&apos;y&apos;,<sp/>or<sp/>&apos;z&apos;</highlight></codeline>
<codeline lineno="84"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="85"><highlight class="stringliteral"><sp/><sp/>*Axes<sp/>4-tuple*:<sp/>e.g.<sp/>(0,<sp/>0,<sp/>0,<sp/>0)<sp/>or<sp/>(1,<sp/>1,<sp/>1,<sp/>1)</highlight></codeline>
<codeline lineno="86"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="87"><highlight class="stringliteral"><sp/><sp/>-<sp/>inner<sp/>axis:<sp/>code<sp/>of<sp/>axis<sp/>(&apos;x&apos;:0,<sp/>&apos;y&apos;:1,<sp/>&apos;z&apos;:2)<sp/>of<sp/>rightmost<sp/>matrix.</highlight></codeline>
<codeline lineno="88"><highlight class="stringliteral"><sp/><sp/>-<sp/>parity<sp/>:<sp/>even<sp/>(0)<sp/>if<sp/>inner<sp/>axis<sp/>&apos;x&apos;<sp/>is<sp/>followed<sp/>by<sp/>&apos;y&apos;,<sp/>&apos;y&apos;<sp/>is<sp/>followed</highlight></codeline>
<codeline lineno="89"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>by<sp/>&apos;z&apos;,<sp/>or<sp/>&apos;z&apos;<sp/>is<sp/>followed<sp/>by<sp/>&apos;x&apos;.<sp/>Otherwise<sp/>odd<sp/>(1).</highlight></codeline>
<codeline lineno="90"><highlight class="stringliteral"><sp/><sp/>-<sp/>repetition<sp/>:<sp/>first<sp/>and<sp/>last<sp/>axis<sp/>are<sp/>same<sp/>(1)<sp/>or<sp/>different<sp/>(0).</highlight></codeline>
<codeline lineno="91"><highlight class="stringliteral"><sp/><sp/>-<sp/>frame<sp/>:<sp/>rotations<sp/>are<sp/>applied<sp/>to<sp/>static<sp/>(0)<sp/>or<sp/>rotating<sp/>(1)<sp/>frame.</highlight></codeline>
<codeline lineno="92"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="93"><highlight class="stringliteral">References</highlight></codeline>
<codeline lineno="94"><highlight class="stringliteral">----------</highlight></codeline>
<codeline lineno="95"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="96"><highlight class="stringliteral">(1)<sp/><sp/>Matrices<sp/>and<sp/>transformations.<sp/>Ronald<sp/>Goldman.</highlight></codeline>
<codeline lineno="97"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>In<sp/>&quot;Graphics<sp/>Gems<sp/>I&quot;,<sp/>pp<sp/>472-475.<sp/>Morgan<sp/>Kaufmann,<sp/>1990.</highlight></codeline>
<codeline lineno="98"><highlight class="stringliteral">(2)<sp/><sp/>More<sp/>matrices<sp/>and<sp/>transformations:<sp/>shear<sp/>and<sp/>pseudo-perspective.</highlight></codeline>
<codeline lineno="99"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>Ronald<sp/>Goldman.<sp/>In<sp/>&quot;Graphics<sp/>Gems<sp/>II&quot;,<sp/>pp<sp/>320-323.<sp/>Morgan<sp/>Kaufmann,<sp/>1991.</highlight></codeline>
<codeline lineno="100"><highlight class="stringliteral">(3)<sp/><sp/>Decomposing<sp/>a<sp/>matrix<sp/>into<sp/>simple<sp/>transformations.<sp/>Spencer<sp/>Thomas.</highlight></codeline>
<codeline lineno="101"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>In<sp/>&quot;Graphics<sp/>Gems<sp/>II&quot;,<sp/>pp<sp/>320-323.<sp/>Morgan<sp/>Kaufmann,<sp/>1991.</highlight></codeline>
<codeline lineno="102"><highlight class="stringliteral">(4)<sp/><sp/>Recovering<sp/>the<sp/>data<sp/>from<sp/>the<sp/>transformation<sp/>matrix.<sp/>Ronald<sp/>Goldman.</highlight></codeline>
<codeline lineno="103"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>In<sp/>&quot;Graphics<sp/>Gems<sp/>II&quot;,<sp/>pp<sp/>324-331.<sp/>Morgan<sp/>Kaufmann,<sp/>1991.</highlight></codeline>
<codeline lineno="104"><highlight class="stringliteral">(5)<sp/><sp/>Euler<sp/>angle<sp/>conversion.<sp/>Ken<sp/>Shoemake.</highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>In<sp/>&quot;Graphics<sp/>Gems<sp/>IV&quot;,<sp/>pp<sp/>222-229.<sp/>Morgan<sp/>Kaufmann,<sp/>1994.</highlight></codeline>
<codeline lineno="106"><highlight class="stringliteral">(6)<sp/><sp/>Arcball<sp/>rotation<sp/>control.<sp/>Ken<sp/>Shoemake.</highlight></codeline>
<codeline lineno="107"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>In<sp/>&quot;Graphics<sp/>Gems<sp/>IV&quot;,<sp/>pp<sp/>175-192.<sp/>Morgan<sp/>Kaufmann,<sp/>1994.</highlight></codeline>
<codeline lineno="108"><highlight class="stringliteral">(7)<sp/><sp/>Representing<sp/>attitude:<sp/>Euler<sp/>angles,<sp/>unit<sp/>quaternions,<sp/>and<sp/>rotation</highlight></codeline>
<codeline lineno="109"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>vectors.<sp/>James<sp/>Diebel.<sp/>2006.</highlight></codeline>
<codeline lineno="110"><highlight class="stringliteral">(8)<sp/><sp/>A<sp/>discussion<sp/>of<sp/>the<sp/>solution<sp/>for<sp/>the<sp/>best<sp/>rotation<sp/>to<sp/>relate<sp/>two<sp/>sets</highlight></codeline>
<codeline lineno="111"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>of<sp/>vectors.<sp/>W<sp/>Kabsch.<sp/>Acta<sp/>Cryst.<sp/>1978.<sp/>A34,<sp/>827-828.</highlight></codeline>
<codeline lineno="112"><highlight class="stringliteral">(9)<sp/><sp/>Closed-form<sp/>solution<sp/>of<sp/>absolute<sp/>orientation<sp/>using<sp/>unit<sp/>quaternions.</highlight></codeline>
<codeline lineno="113"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>BKP<sp/>Horn.<sp/>J<sp/>Opt<sp/>Soc<sp/>Am<sp/>A.<sp/>1987.<sp/>4(4),<sp/>629-642.</highlight></codeline>
<codeline lineno="114"><highlight class="stringliteral">(10)<sp/>Quaternions.<sp/>Ken<sp/>Shoemake.</highlight></codeline>
<codeline lineno="115"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>http://www.sfu.ca/~jwa3/cmpt461/files/quatut.pdf</highlight></codeline>
<codeline lineno="116"><highlight class="stringliteral">(11)<sp/>From<sp/>quaternion<sp/>to<sp/>matrix<sp/>and<sp/>back.<sp/>JMP<sp/>van<sp/>Waveren.<sp/>2005.</highlight></codeline>
<codeline lineno="117"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>http://www.intel.com/cd/ids/developer/asmo-na/eng/293748.htm</highlight></codeline>
<codeline lineno="118"><highlight class="stringliteral">(12)<sp/>Uniform<sp/>random<sp/>rotations.<sp/>Ken<sp/>Shoemake.</highlight></codeline>
<codeline lineno="119"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/>In<sp/>&quot;Graphics<sp/>Gems<sp/>III&quot;,<sp/>pp<sp/>124-132.<sp/>Morgan<sp/>Kaufmann,<sp/>1992.</highlight></codeline>
<codeline lineno="120"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="121"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="122"><highlight class="stringliteral">Examples</highlight></codeline>
<codeline lineno="123"><highlight class="stringliteral">--------</highlight></codeline>
<codeline lineno="124"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="125"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>alpha,<sp/>beta,<sp/>gamma<sp/>=<sp/>0.123,<sp/>-1.234,<sp/>2.345</highlight></codeline>
<codeline lineno="126"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>origin,<sp/>xaxis,<sp/>yaxis,<sp/>zaxis<sp/>=<sp/>(0,<sp/>0,<sp/>0),<sp/>(1,<sp/>0,<sp/>0),<sp/>(0,<sp/>1,<sp/>0),<sp/>(0,<sp/>0,<sp/>1)</highlight></codeline>
<codeline lineno="127"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>I<sp/>=<sp/>identity_matrix()</highlight></codeline>
<codeline lineno="128"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>Rx<sp/>=<sp/>rotation_matrix(alpha,<sp/>xaxis)</highlight></codeline>
<codeline lineno="129"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>Ry<sp/>=<sp/>rotation_matrix(beta,<sp/>yaxis)</highlight></codeline>
<codeline lineno="130"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>Rz<sp/>=<sp/>rotation_matrix(gamma,<sp/>zaxis)</highlight></codeline>
<codeline lineno="131"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>R<sp/>=<sp/>concatenate_matrices(Rx,<sp/>Ry,<sp/>Rz)</highlight></codeline>
<codeline lineno="132"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>euler<sp/>=<sp/>euler_from_matrix(R,<sp/>&apos;rxyz&apos;)</highlight></codeline>
<codeline lineno="133"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>numpy.allclose([alpha,<sp/>beta,<sp/>gamma],<sp/>euler)</highlight></codeline>
<codeline lineno="134"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="135"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>Re<sp/>=<sp/>euler_matrix(alpha,<sp/>beta,<sp/>gamma,<sp/>&apos;rxyz&apos;)</highlight></codeline>
<codeline lineno="136"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>is_same_transform(R,<sp/>Re)</highlight></codeline>
<codeline lineno="137"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="138"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>al,<sp/>be,<sp/>ga<sp/>=<sp/>euler_from_matrix(Re,<sp/>&apos;rxyz&apos;)</highlight></codeline>
<codeline lineno="139"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>is_same_transform(Re,<sp/>euler_matrix(al,<sp/>be,<sp/>ga,<sp/>&apos;rxyz&apos;))</highlight></codeline>
<codeline lineno="140"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="141"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>qx<sp/>=<sp/>quaternion_about_axis(alpha,<sp/>xaxis)</highlight></codeline>
<codeline lineno="142"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>qy<sp/>=<sp/>quaternion_about_axis(beta,<sp/>yaxis)</highlight></codeline>
<codeline lineno="143"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>qz<sp/>=<sp/>quaternion_about_axis(gamma,<sp/>zaxis)</highlight></codeline>
<codeline lineno="144"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_multiply(qx,<sp/>qy)</highlight></codeline>
<codeline lineno="145"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_multiply(q,<sp/>qz)</highlight></codeline>
<codeline lineno="146"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>Rq<sp/>=<sp/>quaternion_matrix(q)</highlight></codeline>
<codeline lineno="147"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>is_same_transform(R,<sp/>Rq)</highlight></codeline>
<codeline lineno="148"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="149"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>S<sp/>=<sp/>scale_matrix(1.23,<sp/>origin)</highlight></codeline>
<codeline lineno="150"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>T<sp/>=<sp/>translation_matrix((1,<sp/>2,<sp/>3))</highlight></codeline>
<codeline lineno="151"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>Z<sp/>=<sp/>shear_matrix(beta,<sp/>xaxis,<sp/>origin,<sp/>zaxis)</highlight></codeline>
<codeline lineno="152"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>R<sp/>=<sp/>random_rotation_matrix(numpy.random.rand(3))</highlight></codeline>
<codeline lineno="153"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>M<sp/>=<sp/>concatenate_matrices(T,<sp/>R,<sp/>Z,<sp/>S)</highlight></codeline>
<codeline lineno="154"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>scale,<sp/>shear,<sp/>angles,<sp/>trans,<sp/>persp<sp/>=<sp/>decompose_matrix(M)</highlight></codeline>
<codeline lineno="155"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>numpy.allclose(scale,<sp/>1.23)</highlight></codeline>
<codeline lineno="156"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="157"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>numpy.allclose(trans,<sp/>(1,<sp/>2,<sp/>3))</highlight></codeline>
<codeline lineno="158"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="159"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>numpy.allclose(shear,<sp/>(0,<sp/>math.tan(beta),<sp/>0))</highlight></codeline>
<codeline lineno="160"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="161"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>is_same_transform(R,<sp/>euler_matrix(axes=&apos;sxyz&apos;,<sp/>*angles))</highlight></codeline>
<codeline lineno="162"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="163"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>M1<sp/>=<sp/>compose_matrix(scale,<sp/>shear,<sp/>angles,<sp/>trans,<sp/>persp)</highlight></codeline>
<codeline lineno="164"><highlight class="stringliteral">&gt;&gt;&gt;<sp/>is_same_transform(M,<sp/>M1)</highlight></codeline>
<codeline lineno="165"><highlight class="stringliteral">True</highlight></codeline>
<codeline lineno="166"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="167"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>__future__<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>division</highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>warnings</highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>math</highlight></codeline>
<codeline lineno="173"><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>numpy</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Documentation<sp/>in<sp/>HTML<sp/>format<sp/>can<sp/>be<sp/>generated<sp/>with<sp/>Epydoc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal">__docformat__<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;restructuredtext<sp/>en&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">identity_matrix():</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>4x4<sp/>identity/unit<sp/>matrix.</highlight></codeline>
<codeline lineno="182"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="183"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>I<sp/>=<sp/>identity_matrix()</highlight></codeline>
<codeline lineno="184"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(I,<sp/>numpy.dot(I,<sp/>I))</highlight></codeline>
<codeline lineno="185"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="186"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.sum(I),<sp/>numpy.trace(I)</highlight></codeline>
<codeline lineno="187"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>(4.0,<sp/>4.0)</highlight></codeline>
<codeline lineno="188"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(I,<sp/>numpy.identity(4,<sp/>dtype=numpy.float64))</highlight></codeline>
<codeline lineno="189"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="190"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="191"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.identity(4,<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">translation_matrix(direction):</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>translate<sp/>by<sp/>direction<sp/>vector.</highlight></codeline>
<codeline lineno="197"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="198"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="199"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v,<sp/>translation_matrix(v)[:3,<sp/>3])</highlight></codeline>
<codeline lineno="200"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="201"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="202"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>direction[:3]</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">translation_from_matrix(matrix):</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>translation<sp/>vector<sp/>from<sp/>translation<sp/>matrix.</highlight></codeline>
<codeline lineno="210"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="211"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="212"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>translation_from_matrix(translation_matrix(v0))</highlight></codeline>
<codeline lineno="213"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v0,<sp/>v1)</highlight></codeline>
<codeline lineno="214"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="215"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="216"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array(matrix,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)[:3,<sp/>3].copy()</highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">reflection_matrix(point,<sp/>normal):</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>mirror<sp/>at<sp/>plane<sp/>defined<sp/>by<sp/>point<sp/>and<sp/>normal<sp/>vector.</highlight></codeline>
<codeline lineno="222"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="223"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>numpy.random.random(4)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="224"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0[3]<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="225"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="226"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>reflection_matrix(v0,<sp/>v1)</highlight></codeline>
<codeline lineno="227"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(2.,<sp/>numpy.trace(R))</highlight></codeline>
<codeline lineno="228"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="229"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v0,<sp/>numpy.dot(R,<sp/>v0))</highlight></codeline>
<codeline lineno="230"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="231"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v2<sp/>=<sp/>v0.copy()</highlight></codeline>
<codeline lineno="232"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v2[:3]<sp/>+=<sp/>v1</highlight></codeline>
<codeline lineno="233"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v3<sp/>=<sp/>v0.copy()</highlight></codeline>
<codeline lineno="234"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v2[:3]<sp/>-=<sp/>v1</highlight></codeline>
<codeline lineno="235"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v2,<sp/>numpy.dot(R,<sp/>v3))</highlight></codeline>
<codeline lineno="236"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="237"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="238"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/>normal<sp/>=<sp/>unit_vector(normal[:3])</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>-=<sp/>2.0<sp/>*<sp/>numpy.outer(normal,<sp/>normal)</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>(2.0<sp/>*<sp/>numpy.dot(point[:3],<sp/>normal))<sp/>*<sp/>normal</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="244"><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">reflection_from_matrix(matrix):</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>mirror<sp/>plane<sp/>point<sp/>and<sp/>normal<sp/>vector<sp/>from<sp/>reflection<sp/>matrix.</highlight></codeline>
<codeline lineno="248"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="249"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="250"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="251"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M0<sp/>=<sp/>reflection_matrix(v0,<sp/>v1)</highlight></codeline>
<codeline lineno="252"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>point,<sp/>normal<sp/>=<sp/>reflection_from_matrix(M0)</highlight></codeline>
<codeline lineno="253"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M1<sp/>=<sp/>reflection_matrix(point,<sp/>normal)</highlight></codeline>
<codeline lineno="254"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(M0,<sp/>M1)</highlight></codeline>
<codeline lineno="255"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="256"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="257"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>normal:<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>-1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M[:3,<sp/>:3])</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>+<sp/>1.0)<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;no<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>-1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/>normal<sp/>=<sp/>numpy.real(V[:,<sp/>i[0]]).squeeze()</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>point:<sp/>any<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M)</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;no<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.real(V[:,<sp/>i[-1]]).squeeze()</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>/=<sp/>point[3]</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>point,<sp/>normal</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">rotation_matrix(angle,<sp/>direction,<sp/>point=None):</highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>rotate<sp/>about<sp/>axis<sp/>defined<sp/>by<sp/>point<sp/>and<sp/>direction.</highlight></codeline>
<codeline lineno="277"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="278"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angle<sp/>=<sp/>(random.random()<sp/>-<sp/>0.5)<sp/>*<sp/>(2*math.pi)</highlight></codeline>
<codeline lineno="279"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direc<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="280"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>point<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="281"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R0<sp/>=<sp/>rotation_matrix(angle,<sp/>direc,<sp/>point)</highlight></codeline>
<codeline lineno="282"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R1<sp/>=<sp/>rotation_matrix(angle-2*math.pi,<sp/>direc,<sp/>point)</highlight></codeline>
<codeline lineno="283"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(R0,<sp/>R1)</highlight></codeline>
<codeline lineno="284"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="285"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R0<sp/>=<sp/>rotation_matrix(angle,<sp/>direc,<sp/>point)</highlight></codeline>
<codeline lineno="286"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R1<sp/>=<sp/>rotation_matrix(-angle,<sp/>-direc,<sp/>point)</highlight></codeline>
<codeline lineno="287"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(R0,<sp/>R1)</highlight></codeline>
<codeline lineno="288"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="289"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>I<sp/>=<sp/>numpy.identity(4,<sp/>numpy.float64)</highlight></codeline>
<codeline lineno="290"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(I,<sp/>rotation_matrix(math.pi*2,<sp/>direc))</highlight></codeline>
<codeline lineno="291"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="292"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(2.,<sp/>numpy.trace(rotation_matrix(math.pi/2,</highlight></codeline>
<codeline lineno="293"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direc,<sp/>point)))</highlight></codeline>
<codeline lineno="294"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="295"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="296"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>sina<sp/>=<sp/>math.sin(angle)</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>cosa<sp/>=<sp/>math.cos(angle)</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>unit_vector(direction[:3])</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>rotation<sp/>matrix<sp/>around<sp/>unit<sp/>vector</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/>R<sp/>=<sp/>numpy.array(((cosa,<sp/>0.0,<sp/><sp/>0.0),</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/><sp/>cosa,<sp/>0.0),</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/><sp/>0.0,<sp/><sp/>cosa)),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/>R<sp/>+=<sp/>numpy.outer(direction,<sp/>direction)<sp/>*<sp/>(1.0<sp/>-<sp/>cosa)</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/>direction<sp/>*=<sp/>sina</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/>R<sp/>+=<sp/>numpy.array(((<sp/>0.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-direction[2],<sp/><sp/>direction[1]),</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/>direction[2],<sp/>0.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-direction[0]),</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(-direction[1],<sp/>direction[0],<sp/><sp/>0.0)),</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>=<sp/>R</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>point<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>rotation<sp/>not<sp/>around<sp/>origin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.array(point[:3],<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>point<sp/>-<sp/>numpy.dot(R,<sp/>point)</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="317"><highlight class="normal"></highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">rotation_from_matrix(matrix):</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>rotation<sp/>angle<sp/>and<sp/>axis<sp/>from<sp/>rotation<sp/>matrix.</highlight></codeline>
<codeline lineno="321"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="322"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angle<sp/>=<sp/>(random.random()<sp/>-<sp/>0.5)<sp/>*<sp/>(2*math.pi)</highlight></codeline>
<codeline lineno="323"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direc<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="324"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>point<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="325"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R0<sp/>=<sp/>rotation_matrix(angle,<sp/>direc,<sp/>point)</highlight></codeline>
<codeline lineno="326"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angle,<sp/>direc,<sp/>point<sp/>=<sp/>rotation_from_matrix(R0)</highlight></codeline>
<codeline lineno="327"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R1<sp/>=<sp/>rotation_matrix(angle,<sp/>direc,<sp/>point)</highlight></codeline>
<codeline lineno="328"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(R0,<sp/>R1)</highlight></codeline>
<codeline lineno="329"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="330"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="331"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/>R<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>R33<sp/>=<sp/>R[:3,<sp/>:3]</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>direction:<sp/>unit<sp/>eigenvector<sp/>of<sp/>R33<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>of<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>W<sp/>=<sp/>numpy.linalg.eig(R33.T)</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;no<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>numpy.real(W[:,<sp/>i[-1]]).squeeze()</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>point:<sp/>unit<sp/>eigenvector<sp/>of<sp/>R33<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>of<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>Q<sp/>=<sp/>numpy.linalg.eig(R)</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;no<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.real(Q[:,<sp/>i[-1]]).squeeze()</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>/=<sp/>point[3]</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>rotation<sp/>angle<sp/>depending<sp/>on<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>cosa<sp/>=<sp/>(numpy.trace(R33)<sp/>-<sp/>1.0)<sp/>/<sp/>2.0</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>abs(direction[2])<sp/>&gt;<sp/>1e-8:</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sina<sp/>=<sp/>(R[1,<sp/>0]<sp/>+<sp/>(cosa-1.0)*direction[0]*direction[1])<sp/>/<sp/>direction[2]</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>abs(direction[1])<sp/>&gt;<sp/>1e-8:</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sina<sp/>=<sp/>(R[0,<sp/>2]<sp/>+<sp/>(cosa-1.0)*direction[0]*direction[2])<sp/>/<sp/>direction[1]</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sina<sp/>=<sp/>(R[2,<sp/>1]<sp/>+<sp/>(cosa-1.0)*direction[1]*direction[2])<sp/>/<sp/>direction[0]</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/>angle<sp/>=<sp/>math.atan2(sina,<sp/>cosa)</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>angle,<sp/>direction,<sp/>point</highlight></codeline>
<codeline lineno="357"><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">scale_matrix(factor,<sp/>origin=None,<sp/>direction=None):</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>scale<sp/>by<sp/>factor<sp/>around<sp/>origin<sp/>in<sp/>direction.</highlight></codeline>
<codeline lineno="361"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="362"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Use<sp/>factor<sp/>-1<sp/>for<sp/>point<sp/>symmetry.</highlight></codeline>
<codeline lineno="363"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="364"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>(numpy.random.rand(4,<sp/>5)<sp/>-<sp/>0.5)<sp/>*<sp/>20.0</highlight></codeline>
<codeline lineno="365"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v[3]<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="366"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S<sp/>=<sp/>scale_matrix(-1.234)</highlight></codeline>
<codeline lineno="367"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.dot(S,<sp/>v)[:3],<sp/>-1.234*v[:3])</highlight></codeline>
<codeline lineno="368"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="369"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>factor<sp/>=<sp/>random.random()<sp/>*<sp/>10<sp/>-<sp/>5</highlight></codeline>
<codeline lineno="370"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>origin<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="371"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direct<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="372"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S<sp/>=<sp/>scale_matrix(factor,<sp/>origin)</highlight></codeline>
<codeline lineno="373"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S<sp/>=<sp/>scale_matrix(factor,<sp/>origin,<sp/>direct)</highlight></codeline>
<codeline lineno="374"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="375"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>direction<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>uniform<sp/>scaling</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(((factor,<sp/>0.0,<sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/>0.0),</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/><sp/><sp/><sp/>factor,<sp/>0.0,<sp/><sp/><sp/><sp/>0.0),</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/>factor,<sp/>0.0),</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/>1.0)),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>origin<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>origin[:3]</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>*=<sp/>1.0<sp/>-<sp/>factor</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>nonuniform<sp/>scaling</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>unit_vector(direction[:3])</highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>factor<sp/>=<sp/>1.0<sp/>-<sp/>factor</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>-=<sp/>factor<sp/>*<sp/>numpy.outer(direction,<sp/>direction)</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>origin<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>(factor<sp/>*<sp/>numpy.dot(origin[:3],<sp/>direction))<sp/>*<sp/>direction</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">scale_from_matrix(matrix):</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>scaling<sp/>factor,<sp/>origin<sp/>and<sp/>direction<sp/>from<sp/>scaling<sp/>matrix.</highlight></codeline>
<codeline lineno="398"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="399"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>factor<sp/>=<sp/>random.random()<sp/>*<sp/>10<sp/>-<sp/>5</highlight></codeline>
<codeline lineno="400"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>origin<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="401"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direct<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="402"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S0<sp/>=<sp/>scale_matrix(factor,<sp/>origin)</highlight></codeline>
<codeline lineno="403"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>factor,<sp/>origin,<sp/>direction<sp/>=<sp/>scale_from_matrix(S0)</highlight></codeline>
<codeline lineno="404"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S1<sp/>=<sp/>scale_matrix(factor,<sp/>origin,<sp/>direction)</highlight></codeline>
<codeline lineno="405"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(S0,<sp/>S1)</highlight></codeline>
<codeline lineno="406"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="407"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S0<sp/>=<sp/>scale_matrix(factor,<sp/>origin,<sp/>direct)</highlight></codeline>
<codeline lineno="408"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>factor,<sp/>origin,<sp/>direction<sp/>=<sp/>scale_from_matrix(S0)</highlight></codeline>
<codeline lineno="409"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S1<sp/>=<sp/>scale_matrix(factor,<sp/>origin,<sp/>direction)</highlight></codeline>
<codeline lineno="410"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(S0,<sp/>S1)</highlight></codeline>
<codeline lineno="411"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="412"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="413"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/>M33<sp/>=<sp/>M[:3,<sp/>:3]</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/>factor<sp/>=<sp/>numpy.trace(M33)<sp/>-<sp/>2.0</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>direction:<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>factor</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M33)</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>factor)<sp/>&lt;<sp/>1e-8)[0][0]</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>numpy.real(V[:,<sp/>i]).squeeze()</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direction<sp/>/=<sp/>vector_norm(direction)</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>IndexError:</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>uniform<sp/>scaling</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>factor<sp/>=<sp/>(factor<sp/>+<sp/>2.0)<sp/>/<sp/>3.0</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direction<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>origin:<sp/>any<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M)</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;no<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/>origin<sp/>=<sp/>numpy.real(V[:,<sp/>i[-1]]).squeeze()</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/>origin<sp/>/=<sp/>origin[3]</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>factor,<sp/>origin,<sp/>direction</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">projection_matrix(point,<sp/>normal,<sp/>direction=None,</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective=None,<sp/>pseudo=False):</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>project<sp/>onto<sp/>plane<sp/>defined<sp/>by<sp/>point<sp/>and<sp/>normal.</highlight></codeline>
<codeline lineno="440"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="441"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Using<sp/>either<sp/>perspective<sp/>point,<sp/>projection<sp/>direction,<sp/>or<sp/>none<sp/>of<sp/>both.</highlight></codeline>
<codeline lineno="442"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="443"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>If<sp/>pseudo<sp/>is<sp/>True,<sp/>perspective<sp/>projections<sp/>will<sp/>preserve<sp/>relative<sp/>depth</highlight></codeline>
<codeline lineno="444"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>such<sp/>that<sp/>Perspective<sp/>=<sp/>dot(Orthogonal,<sp/>PseudoPerspective).</highlight></codeline>
<codeline lineno="445"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="446"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P<sp/>=<sp/>projection_matrix((0,<sp/>0,<sp/>0),<sp/>(1,<sp/>0,<sp/>0))</highlight></codeline>
<codeline lineno="447"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(P[1:,<sp/>1:],<sp/>numpy.identity(4)[1:,<sp/>1:])</highlight></codeline>
<codeline lineno="448"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="449"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>point<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="450"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>normal<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="451"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direct<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="452"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>persp<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="453"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P0<sp/>=<sp/>projection_matrix(point,<sp/>normal)</highlight></codeline>
<codeline lineno="454"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P1<sp/>=<sp/>projection_matrix(point,<sp/>normal,<sp/>direction=direct)</highlight></codeline>
<codeline lineno="455"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P2<sp/>=<sp/>projection_matrix(point,<sp/>normal,<sp/>perspective=persp)</highlight></codeline>
<codeline lineno="456"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P3<sp/>=<sp/>projection_matrix(point,<sp/>normal,<sp/>perspective=persp,<sp/>pseudo=True)</highlight></codeline>
<codeline lineno="457"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(P2,<sp/>numpy.dot(P0,<sp/>P3))</highlight></codeline>
<codeline lineno="458"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="459"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P<sp/>=<sp/>projection_matrix((3,<sp/>0,<sp/>0),<sp/>(1,<sp/>1,<sp/>0),<sp/>(1,<sp/>0,<sp/>0))</highlight></codeline>
<codeline lineno="460"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>(numpy.random.rand(4,<sp/>5)<sp/>-<sp/>0.5)<sp/>*<sp/>20.0</highlight></codeline>
<codeline lineno="461"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0[3]<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="462"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>numpy.dot(P,<sp/>v0)</highlight></codeline>
<codeline lineno="463"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1[1],<sp/>v0[1])</highlight></codeline>
<codeline lineno="464"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="465"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1[0],<sp/>3.0-v1[1])</highlight></codeline>
<codeline lineno="466"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="467"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="468"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.array(point[:3],<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/>normal<sp/>=<sp/>unit_vector(normal[:3])</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>perspective<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>perspective<sp/>projection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective<sp/>=<sp/>numpy.array(perspective[:3],<sp/>dtype=numpy.float64,</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[0,<sp/>0]<sp/>=<sp/>M[1,<sp/>1]<sp/>=<sp/>M[2,<sp/>2]<sp/>=<sp/>numpy.dot(perspective-point,<sp/>normal)</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>-=<sp/>numpy.outer(perspective,<sp/>normal)</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>pseudo:</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>preserve<sp/>relative<sp/>depth</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>-=<sp/>numpy.outer(normal,<sp/>normal)</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>numpy.dot(point,<sp/>normal)<sp/>*<sp/>(perspective+normal)</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>numpy.dot(point,<sp/>normal)<sp/>*<sp/>perspective</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[3,<sp/>:3]<sp/>=<sp/>-normal</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[3,<sp/>3]<sp/>=<sp/>numpy.dot(perspective,<sp/>normal)</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>direction<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>parallel<sp/>projection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>numpy.array(direction[:3],<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scale<sp/>=<sp/>numpy.dot(direction,<sp/>normal)</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>-=<sp/>numpy.outer(direction,<sp/>normal)<sp/>/<sp/>scale</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>direction<sp/>*<sp/>(numpy.dot(point,<sp/>normal)<sp/>/<sp/>scale)</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>orthogonal<sp/>projection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>-=<sp/>numpy.outer(normal,<sp/>normal)</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>numpy.dot(point,<sp/>normal)<sp/>*<sp/>normal</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="497"><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">projection_from_matrix(matrix,<sp/>pseudo=False):</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>projection<sp/>plane<sp/>and<sp/>perspective<sp/>point<sp/>from<sp/>projection<sp/>matrix.</highlight></codeline>
<codeline lineno="501"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="502"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Return<sp/>values<sp/>are<sp/>same<sp/>as<sp/>arguments<sp/>for<sp/>projection_matrix<sp/>function:</highlight></codeline>
<codeline lineno="503"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>point,<sp/>normal,<sp/>direction,<sp/>perspective,<sp/>and<sp/>pseudo.</highlight></codeline>
<codeline lineno="504"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="505"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>point<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="506"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>normal<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="507"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direct<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="508"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>persp<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="509"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P0<sp/>=<sp/>projection_matrix(point,<sp/>normal)</highlight></codeline>
<codeline lineno="510"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>result<sp/>=<sp/>projection_from_matrix(P0)</highlight></codeline>
<codeline lineno="511"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P1<sp/>=<sp/>projection_matrix(*result)</highlight></codeline>
<codeline lineno="512"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(P0,<sp/>P1)</highlight></codeline>
<codeline lineno="513"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="514"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P0<sp/>=<sp/>projection_matrix(point,<sp/>normal,<sp/>direct)</highlight></codeline>
<codeline lineno="515"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>result<sp/>=<sp/>projection_from_matrix(P0)</highlight></codeline>
<codeline lineno="516"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P1<sp/>=<sp/>projection_matrix(*result)</highlight></codeline>
<codeline lineno="517"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(P0,<sp/>P1)</highlight></codeline>
<codeline lineno="518"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="519"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P0<sp/>=<sp/>projection_matrix(point,<sp/>normal,<sp/>perspective=persp,<sp/>pseudo=False)</highlight></codeline>
<codeline lineno="520"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>result<sp/>=<sp/>projection_from_matrix(P0,<sp/>pseudo=False)</highlight></codeline>
<codeline lineno="521"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P1<sp/>=<sp/>projection_matrix(*result)</highlight></codeline>
<codeline lineno="522"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(P0,<sp/>P1)</highlight></codeline>
<codeline lineno="523"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="524"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P0<sp/>=<sp/>projection_matrix(point,<sp/>normal,<sp/>perspective=persp,<sp/>pseudo=True)</highlight></codeline>
<codeline lineno="525"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>result<sp/>=<sp/>projection_from_matrix(P0,<sp/>pseudo=True)</highlight></codeline>
<codeline lineno="526"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>P1<sp/>=<sp/>projection_matrix(*result)</highlight></codeline>
<codeline lineno="527"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(P0,<sp/>P1)</highlight></codeline>
<codeline lineno="528"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="529"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="530"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/>M33<sp/>=<sp/>M[:3,<sp/>:3]</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M)</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>pseudo<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>point:<sp/>any<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.real(V[:,<sp/>i[-1]]).squeeze()</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>point<sp/>/=<sp/>point[3]</highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>direction:<sp/>unit<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M33)</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l))<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;no<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>0&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>numpy.real(V[:,<sp/>i[0]]).squeeze()</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>direction<sp/>/=<sp/>vector_norm(direction)</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>normal:<sp/>unit<sp/>eigenvector<sp/>of<sp/>M33.T<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M33.T)</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l))<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>parallel<sp/>projection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>normal<sp/>=<sp/>numpy.real(V[:,<sp/>i[0]]).squeeze()</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>normal<sp/>/=<sp/>vector_norm(normal)</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>point,<sp/>normal,<sp/>direction,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>orthogonal<sp/>projection,<sp/>where<sp/>normal<sp/>equals<sp/>direction<sp/>vector</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>point,<sp/>direction,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>perspective<sp/>projection</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l))<sp/>&gt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;no<sp/>eigenvector<sp/>not<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>0&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.real(V[:,<sp/>i[-1]]).squeeze()</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>point<sp/>/=<sp/>point[3]</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>normal<sp/>=<sp/>-<sp/>M[3,<sp/>:3]</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective<sp/>=<sp/>M[:3,<sp/>3]<sp/>/<sp/>numpy.dot(point[:3],<sp/>normal)</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>pseudo:</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective<sp/>-=<sp/>normal</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>point,<sp/>normal,<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>perspective,<sp/>pseudo</highlight></codeline>
<codeline lineno="570"><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"></highlight></codeline>
<codeline lineno="572"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">clip_matrix(left,<sp/>right,<sp/>bottom,<sp/>top,<sp/>near,<sp/>far,<sp/>perspective=False):</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>obtain<sp/>normalized<sp/>device<sp/>coordinates<sp/>from<sp/>frustrum.</highlight></codeline>
<codeline lineno="574"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="575"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>frustrum<sp/>bounds<sp/>are<sp/>axis-aligned<sp/>along<sp/>x<sp/>(left,<sp/>right),</highlight></codeline>
<codeline lineno="576"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>y<sp/>(bottom,<sp/>top)<sp/>and<sp/>z<sp/>(near,<sp/>far).</highlight></codeline>
<codeline lineno="577"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="578"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Normalized<sp/>device<sp/>coordinates<sp/>are<sp/>in<sp/>range<sp/>[-1,<sp/>1]<sp/>if<sp/>coordinates<sp/>are</highlight></codeline>
<codeline lineno="579"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>inside<sp/>the<sp/>frustrum.</highlight></codeline>
<codeline lineno="580"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="581"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>If<sp/>perspective<sp/>is<sp/>True<sp/>the<sp/>frustrum<sp/>is<sp/>a<sp/>truncated<sp/>pyramid<sp/>with<sp/>the</highlight></codeline>
<codeline lineno="582"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>perspective<sp/>point<sp/>at<sp/>origin<sp/>and<sp/>direction<sp/>along<sp/>z<sp/>axis,<sp/>otherwise<sp/>an</highlight></codeline>
<codeline lineno="583"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>orthographic<sp/>canonical<sp/>view<sp/>volume<sp/>(a<sp/>box).</highlight></codeline>
<codeline lineno="584"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="585"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Homogeneous<sp/>coordinates<sp/>transformed<sp/>by<sp/>the<sp/>perspective<sp/>clip<sp/>matrix</highlight></codeline>
<codeline lineno="586"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>need<sp/>to<sp/>be<sp/>dehomogenized<sp/>(devided<sp/>by<sp/>w<sp/>coordinate).</highlight></codeline>
<codeline lineno="587"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="588"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>frustrum<sp/>=<sp/>numpy.random.rand(6)</highlight></codeline>
<codeline lineno="589"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>frustrum[1]<sp/>+=<sp/>frustrum[0]</highlight></codeline>
<codeline lineno="590"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>frustrum[3]<sp/>+=<sp/>frustrum[2]</highlight></codeline>
<codeline lineno="591"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>frustrum[5]<sp/>+=<sp/>frustrum[4]</highlight></codeline>
<codeline lineno="592"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>clip_matrix(*frustrum,<sp/>perspective=False)</highlight></codeline>
<codeline lineno="593"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.dot(M,<sp/>[frustrum[0],<sp/>frustrum[2],<sp/>frustrum[4],<sp/>1.0])</highlight></codeline>
<codeline lineno="594"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>array([-1.,<sp/>-1.,<sp/>-1.,<sp/><sp/>1.])</highlight></codeline>
<codeline lineno="595"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.dot(M,<sp/>[frustrum[1],<sp/>frustrum[3],<sp/>frustrum[5],<sp/>1.0])</highlight></codeline>
<codeline lineno="596"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>array([<sp/>1.,<sp/><sp/>1.,<sp/><sp/>1.,<sp/><sp/>1.])</highlight></codeline>
<codeline lineno="597"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>clip_matrix(*frustrum,<sp/>perspective=True)</highlight></codeline>
<codeline lineno="598"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>numpy.dot(M,<sp/>[frustrum[0],<sp/>frustrum[2],<sp/>frustrum[4],<sp/>1.0])</highlight></codeline>
<codeline lineno="599"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>/<sp/>v[3]</highlight></codeline>
<codeline lineno="600"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>array([-1.,<sp/>-1.,<sp/>-1.,<sp/><sp/>1.])</highlight></codeline>
<codeline lineno="601"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>numpy.dot(M,<sp/>[frustrum[1],<sp/>frustrum[3],<sp/>frustrum[4],<sp/>1.0])</highlight></codeline>
<codeline lineno="602"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>/<sp/>v[3]</highlight></codeline>
<codeline lineno="603"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>array([<sp/>1.,<sp/><sp/>1.,<sp/>-1.,<sp/><sp/>1.])</highlight></codeline>
<codeline lineno="604"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="605"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>left<sp/>&gt;=<sp/>right<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>bottom<sp/>&gt;=<sp/>top<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>near<sp/>&gt;=<sp/>far:</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;invalid<sp/>frustrum&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>perspective:</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>near<sp/>&lt;=<sp/>_EPS:</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;invalid<sp/>frustrum:<sp/>near<sp/>&lt;=<sp/>0&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t<sp/>=<sp/>2.0<sp/>*<sp/>near</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>((-t/(right-left),<sp/>0.0,<sp/>(right+left)/(right-left),<sp/>0.0),</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/>-t/(top-bottom),<sp/>(top+bottom)/(top-bottom),<sp/>0.0),</highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/>0.0,<sp/>-(far+near)/(far-near),<sp/>t*far/(far-near)),</highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/>0.0,<sp/>-1.0,<sp/>0.0))</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>((2.0/(right-left),<sp/>0.0,<sp/>0.0,<sp/>(right+left)/(left-right)),</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/>2.0/(top-bottom),<sp/>0.0,<sp/>(top+bottom)/(bottom-top)),</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/>0.0,<sp/>2.0/(far-near),<sp/>(far+near)/(near-far)),</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(0.0,<sp/>0.0,<sp/>0.0,<sp/>1.0))</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array(M,<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="622"><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"></highlight></codeline>
<codeline lineno="624"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">shear_matrix(angle,<sp/>direction,<sp/>point,<sp/>normal):</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>shear<sp/>by<sp/>angle<sp/>along<sp/>direction<sp/>vector<sp/>on<sp/>shear<sp/>plane.</highlight></codeline>
<codeline lineno="626"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="627"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>shear<sp/>plane<sp/>is<sp/>defined<sp/>by<sp/>a<sp/>point<sp/>and<sp/>normal<sp/>vector.<sp/>The<sp/>direction</highlight></codeline>
<codeline lineno="628"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>vector<sp/>must<sp/>be<sp/>orthogonal<sp/>to<sp/>the<sp/>plane&apos;s<sp/>normal<sp/>vector.</highlight></codeline>
<codeline lineno="629"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="630"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>A<sp/>point<sp/>P<sp/>is<sp/>transformed<sp/>by<sp/>the<sp/>shear<sp/>matrix<sp/>into<sp/>P&quot;<sp/>such<sp/>that</highlight></codeline>
<codeline lineno="631"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>the<sp/>vector<sp/>P-P&quot;<sp/>is<sp/>parallel<sp/>to<sp/>the<sp/>direction<sp/>vector<sp/>and<sp/>its<sp/>extent<sp/>is</highlight></codeline>
<codeline lineno="632"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>given<sp/>by<sp/>the<sp/>angle<sp/>of<sp/>P-P&apos;-P&quot;,<sp/>where<sp/>P&apos;<sp/>is<sp/>the<sp/>orthogonal<sp/>projection</highlight></codeline>
<codeline lineno="633"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>of<sp/>P<sp/>onto<sp/>the<sp/>shear<sp/>plane.</highlight></codeline>
<codeline lineno="634"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="635"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angle<sp/>=<sp/>(random.random()<sp/>-<sp/>0.5)<sp/>*<sp/>4*math.pi</highlight></codeline>
<codeline lineno="636"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direct<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="637"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>point<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="638"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>normal<sp/>=<sp/>numpy.cross(direct,<sp/>numpy.random.random(3))</highlight></codeline>
<codeline lineno="639"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S<sp/>=<sp/>shear_matrix(angle,<sp/>direct,<sp/>point,<sp/>normal)</highlight></codeline>
<codeline lineno="640"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(1.0,<sp/>numpy.linalg.det(S))</highlight></codeline>
<codeline lineno="641"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="642"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="643"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/>normal<sp/>=<sp/>unit_vector(normal[:3])</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>unit_vector(direction[:3])</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>abs(numpy.dot(normal,<sp/>direction))<sp/>&gt;<sp/>1e-6:</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;direction<sp/>and<sp/>normal<sp/>vectors<sp/>are<sp/>not<sp/>orthogonal&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/>angle<sp/>=<sp/>math.tan(angle)</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>+=<sp/>angle<sp/>*<sp/>numpy.outer(direction,<sp/>normal)</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>-angle<sp/>*<sp/>numpy.dot(point[:3],<sp/>normal)<sp/>*<sp/>direction</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">shear_from_matrix(matrix):</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>shear<sp/>angle,<sp/>direction<sp/>and<sp/>plane<sp/>from<sp/>shear<sp/>matrix.</highlight></codeline>
<codeline lineno="657"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="658"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angle<sp/>=<sp/>(random.random()<sp/>-<sp/>0.5)<sp/>*<sp/>4*math.pi</highlight></codeline>
<codeline lineno="659"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>direct<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="660"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>point<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="661"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>normal<sp/>=<sp/>numpy.cross(direct,<sp/>numpy.random.random(3))</highlight></codeline>
<codeline lineno="662"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S0<sp/>=<sp/>shear_matrix(angle,<sp/>direct,<sp/>point,<sp/>normal)</highlight></codeline>
<codeline lineno="663"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angle,<sp/>direct,<sp/>point,<sp/>normal<sp/>=<sp/>shear_from_matrix(S0)</highlight></codeline>
<codeline lineno="664"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S1<sp/>=<sp/>shear_matrix(angle,<sp/>direct,<sp/>point,<sp/>normal)</highlight></codeline>
<codeline lineno="665"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(S0,<sp/>S1)</highlight></codeline>
<codeline lineno="666"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="667"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="668"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/>M33<sp/>=<sp/>M[:3,<sp/>:3]</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>normal:<sp/>cross<sp/>independent<sp/>eigenvectors<sp/>corresponding<sp/>to<sp/>the<sp/>eigenvalue<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M33)</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>1e-4)[0]</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(i)<sp/>&lt;<sp/>2:</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;No<sp/>two<sp/>linear<sp/>independent<sp/>eigenvectors<sp/>found<sp/>{}&quot;</highlight><highlight class="normal">.format(l))</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/>V<sp/>=<sp/>numpy.real(V[:,<sp/>i]).squeeze().T</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>lenorm<sp/>=<sp/>-1.0</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i0,<sp/>i1<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>((0,<sp/>1),<sp/>(0,<sp/>2),<sp/>(1,<sp/>2)):</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>=<sp/>numpy.cross(V[i0],<sp/>V[i1])</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l<sp/>=<sp/>vector_norm(n)</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>l<sp/>&gt;<sp/>lenorm:</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lenorm<sp/>=<sp/>l</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>normal<sp/>=<sp/>n</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/>normal<sp/>/=<sp/>lenorm</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>direction<sp/>and<sp/>angle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>direction<sp/>=<sp/>numpy.dot(M33<sp/>-<sp/>numpy.identity(3),<sp/>normal)</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/>angle<sp/>=<sp/>vector_norm(direction)</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/>direction<sp/>/=<sp/>angle</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/>angle<sp/>=<sp/>math.atan(angle)</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>point:<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(M)</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>numpy.where(abs(numpy.real(l)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>1e-8)[0]</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>len(i):</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;no<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>eigenvalue<sp/>1&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.real(V[:,<sp/>i[-1]]).squeeze()</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>/=<sp/>point[3]</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>angle,<sp/>direction,<sp/>point,<sp/>normal</highlight></codeline>
<codeline lineno="698"><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">decompose_matrix(matrix):</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>sequence<sp/>of<sp/>transformations<sp/>from<sp/>transformation<sp/>matrix.</highlight></codeline>
<codeline lineno="702"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="703"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>matrix<sp/>:<sp/>array_like</highlight></codeline>
<codeline lineno="704"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Non-degenerative<sp/>homogeneous<sp/>transformation<sp/>matrix</highlight></codeline>
<codeline lineno="705"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="706"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Return<sp/>tuple<sp/>of:</highlight></codeline>
<codeline lineno="707"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scale<sp/>:<sp/>vector<sp/>of<sp/>3<sp/>scaling<sp/>factors</highlight></codeline>
<codeline lineno="708"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear<sp/>:<sp/>list<sp/>of<sp/>shear<sp/>factors<sp/>for<sp/>x-y,<sp/>x-z,<sp/>y-z<sp/>axes</highlight></codeline>
<codeline lineno="709"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angles<sp/>:<sp/>list<sp/>of<sp/>Euler<sp/>angles<sp/>about<sp/>static<sp/>x,<sp/>y,<sp/>z<sp/>axes</highlight></codeline>
<codeline lineno="710"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>translate<sp/>:<sp/>translation<sp/>vector<sp/>along<sp/>x,<sp/>y,<sp/>z<sp/>axes</highlight></codeline>
<codeline lineno="711"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective<sp/>:<sp/>perspective<sp/>partition<sp/>of<sp/>matrix</highlight></codeline>
<codeline lineno="712"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="713"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Raise<sp/>ValueError<sp/>if<sp/>matrix<sp/>is<sp/>of<sp/>wrong<sp/>type<sp/>or<sp/>degenerative.</highlight></codeline>
<codeline lineno="714"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="715"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>T0<sp/>=<sp/>translation_matrix((1,<sp/>2,<sp/>3))</highlight></codeline>
<codeline lineno="716"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>scale,<sp/>shear,<sp/>angles,<sp/>trans,<sp/>persp<sp/>=<sp/>decompose_matrix(T0)</highlight></codeline>
<codeline lineno="717"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>T1<sp/>=<sp/>translation_matrix(trans)</highlight></codeline>
<codeline lineno="718"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(T0,<sp/>T1)</highlight></codeline>
<codeline lineno="719"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="720"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S<sp/>=<sp/>scale_matrix(0.123)</highlight></codeline>
<codeline lineno="721"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>scale,<sp/>shear,<sp/>angles,<sp/>trans,<sp/>persp<sp/>=<sp/>decompose_matrix(S)</highlight></codeline>
<codeline lineno="722"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>scale[0]</highlight></codeline>
<codeline lineno="723"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>0.123</highlight></codeline>
<codeline lineno="724"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R0<sp/>=<sp/>euler_matrix(1,<sp/>2,<sp/>3)</highlight></codeline>
<codeline lineno="725"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>scale,<sp/>shear,<sp/>angles,<sp/>trans,<sp/>persp<sp/>=<sp/>decompose_matrix(R0)</highlight></codeline>
<codeline lineno="726"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R1<sp/>=<sp/>euler_matrix(*angles)</highlight></codeline>
<codeline lineno="727"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(R0,<sp/>R1)</highlight></codeline>
<codeline lineno="728"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="729"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="730"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">).T</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>abs(M[3,<sp/>3])<sp/>&lt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;M[3,<sp/>3]<sp/>is<sp/>zero&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>/=<sp/>M[3,<sp/>3]</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/>P<sp/>=<sp/>M.copy()</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/>P[:,<sp/>3]<sp/>=<sp/>0,<sp/>0,<sp/>0,<sp/>1</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>numpy.linalg.det(P):</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Matrix<sp/>is<sp/>singular&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="739"><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/>scale<sp/>=<sp/>numpy.zeros((3,<sp/>),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/>shear<sp/>=<sp/>[0,<sp/>0,<sp/>0]</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/>angles<sp/>=<sp/>[0,<sp/>0,<sp/>0]</highlight></codeline>
<codeline lineno="743"><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>any(abs(M[:3,<sp/>3])<sp/>&gt;<sp/>_EPS):</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective<sp/>=<sp/>numpy.dot(M[:,<sp/>3],<sp/>numpy.linalg.inv(P.T))</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:,<sp/>3]<sp/>=<sp/>0,<sp/>0,<sp/>0,<sp/>1</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective<sp/>=<sp/>numpy.array((0,<sp/>0,<sp/>0,<sp/>1),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/>translate<sp/>=<sp/>M[3,<sp/>:3].copy()</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/>M[3,<sp/>:3]<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="752"><highlight class="normal"></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/>row<sp/>=<sp/>M[:3,<sp/>:3].copy()</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/>scale[0]<sp/>=<sp/>vector_norm(row[0])</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/>row[0]<sp/>/=<sp/>scale[0]</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/>shear[0]<sp/>=<sp/>numpy.dot(row[0],<sp/>row[1])</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/>row[1]<sp/>-=<sp/>row[0]<sp/>*<sp/>shear[0]</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/>scale[1]<sp/>=<sp/>vector_norm(row[1])</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/>row[1]<sp/>/=<sp/>scale[1]</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/>shear[0]<sp/>/=<sp/>scale[1]</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/>shear[1]<sp/>=<sp/>numpy.dot(row[0],<sp/>row[2])</highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>row[2]<sp/>-=<sp/>row[0]<sp/>*<sp/>shear[1]</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/>shear[2]<sp/>=<sp/>numpy.dot(row[1],<sp/>row[2])</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/>row[2]<sp/>-=<sp/>row[1]<sp/>*<sp/>shear[2]</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/>scale[2]<sp/>=<sp/>vector_norm(row[2])</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/>row[2]<sp/>/=<sp/>scale[2]</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/>shear[1:]<sp/>/=<sp/>scale[2]</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>numpy.dot(row[0],<sp/>numpy.cross(row[1],<sp/>row[2]))<sp/>&lt;<sp/>0:</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scale<sp/>*=<sp/>-1</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>row<sp/>*=<sp/>-1</highlight></codeline>
<codeline lineno="772"><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/>angles[1]<sp/>=<sp/>math.asin(-row[0,<sp/>2])</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>math.cos(angles[1]):</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angles[0]<sp/>=<sp/>math.atan2(row[1,<sp/>2],<sp/>row[2,<sp/>2])</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angles[2]<sp/>=<sp/>math.atan2(row[0,<sp/>1],<sp/>row[0,<sp/>0])</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#angles[0]<sp/>=<sp/>math.atan2(row[1,<sp/>0],<sp/>row[1,<sp/>1])</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angles[0]<sp/>=<sp/>math.atan2(-row[2,<sp/>1],<sp/>row[1,<sp/>1])</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angles[2]<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="781"><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>scale,<sp/>shear,<sp/>angles,<sp/>translate,<sp/>perspective</highlight></codeline>
<codeline lineno="783"><highlight class="normal"></highlight></codeline>
<codeline lineno="784"><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">compose_matrix(scale=None,<sp/>shear=None,<sp/>angles=None,<sp/>translate=None,</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective=None):</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>transformation<sp/>matrix<sp/>from<sp/>sequence<sp/>of<sp/>transformations.</highlight></codeline>
<codeline lineno="788"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="789"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>This<sp/>is<sp/>the<sp/>inverse<sp/>of<sp/>the<sp/>decompose_matrix<sp/>function.</highlight></codeline>
<codeline lineno="790"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="791"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Sequence<sp/>of<sp/>transformations:</highlight></codeline>
<codeline lineno="792"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>scale<sp/>:<sp/>vector<sp/>of<sp/>3<sp/>scaling<sp/>factors</highlight></codeline>
<codeline lineno="793"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>shear<sp/>:<sp/>list<sp/>of<sp/>shear<sp/>factors<sp/>for<sp/>x-y,<sp/>x-z,<sp/>y-z<sp/>axes</highlight></codeline>
<codeline lineno="794"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angles<sp/>:<sp/>list<sp/>of<sp/>Euler<sp/>angles<sp/>about<sp/>static<sp/>x,<sp/>y,<sp/>z<sp/>axes</highlight></codeline>
<codeline lineno="795"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>translate<sp/>:<sp/>translation<sp/>vector<sp/>along<sp/>x,<sp/>y,<sp/>z<sp/>axes</highlight></codeline>
<codeline lineno="796"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>perspective<sp/>:<sp/>perspective<sp/>partition<sp/>of<sp/>matrix</highlight></codeline>
<codeline lineno="797"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="798"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>scale<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="799"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>shear<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="800"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angles<sp/>=<sp/>(numpy.random.random(3)<sp/>-<sp/>0.5)<sp/>*<sp/>(2*math.pi)</highlight></codeline>
<codeline lineno="801"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>trans<sp/>=<sp/>numpy.random.random(3)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="802"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>persp<sp/>=<sp/>numpy.random.random(4)<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="803"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M0<sp/>=<sp/>compose_matrix(scale,<sp/>shear,<sp/>angles,<sp/>trans,<sp/>persp)</highlight></codeline>
<codeline lineno="804"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>result<sp/>=<sp/>decompose_matrix(M0)</highlight></codeline>
<codeline lineno="805"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M1<sp/>=<sp/>compose_matrix(*result)</highlight></codeline>
<codeline lineno="806"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(M0,<sp/>M1)</highlight></codeline>
<codeline lineno="807"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="808"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="809"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>perspective<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>P<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>P[3,<sp/>:]<sp/>=<sp/>perspective[:4]</highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.dot(M,<sp/>P)</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>translate<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T[:3,<sp/>3]<sp/>=<sp/>translate[:3]</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.dot(M,<sp/>T)</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>angles<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>R<sp/>=<sp/>euler_matrix(angles[0],<sp/>angles[1],<sp/>angles[2],<sp/></highlight><highlight class="stringliteral">&apos;sxyz&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.dot(M,<sp/>R)</highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>shear<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Z<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Z[1,<sp/>2]<sp/>=<sp/>shear[2]</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Z[0,<sp/>2]<sp/>=<sp/>shear[1]</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Z[0,<sp/>1]<sp/>=<sp/>shear[0]</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.dot(M,<sp/>Z)</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>scale<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>S<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>S[0,<sp/>0]<sp/>=<sp/>scale[0]</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>S[1,<sp/>1]<sp/>=<sp/>scale[1]</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>S[2,<sp/>2]<sp/>=<sp/>scale[2]</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.dot(M,<sp/>S)</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>/=<sp/>M[3,<sp/>3]</highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="836"><highlight class="normal"></highlight></codeline>
<codeline lineno="837"><highlight class="normal"></highlight></codeline>
<codeline lineno="838"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">orthogonalization_matrix(lengths,<sp/>angles):</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>orthogonalization<sp/>matrix<sp/>for<sp/>crystallographic<sp/>cell<sp/>coordinates.</highlight></codeline>
<codeline lineno="840"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="841"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Angles<sp/>are<sp/>expected<sp/>in<sp/>degrees.</highlight></codeline>
<codeline lineno="842"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="843"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>de-orthogonalization<sp/>matrix<sp/>is<sp/>the<sp/>inverse.</highlight></codeline>
<codeline lineno="844"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="845"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>O<sp/>=<sp/>orthogonalization_matrix((10.,<sp/>10.,<sp/>10.),<sp/>(90.,<sp/>90.,<sp/>90.))</highlight></codeline>
<codeline lineno="846"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(O[:3,<sp/>:3],<sp/>numpy.identity(3,<sp/>float)<sp/>*<sp/>10)</highlight></codeline>
<codeline lineno="847"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="848"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>O<sp/>=<sp/>orthogonalization_matrix([9.8,<sp/>12.0,<sp/>15.5],<sp/>[87.2,<sp/>80.7,<sp/>69.7])</highlight></codeline>
<codeline lineno="849"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.sum(O),<sp/>43.063229)</highlight></codeline>
<codeline lineno="850"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="851"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="852"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/>a,<sp/>b,<sp/>c<sp/>=<sp/>lengths</highlight></codeline>
<codeline lineno="854"><highlight class="normal"><sp/><sp/><sp/><sp/>angles<sp/>=<sp/>numpy.radians(angles)</highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/>sina,<sp/>sinb,<sp/>_<sp/>=<sp/>numpy.sin(angles)</highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/>cosa,<sp/>cosb,<sp/>cosg<sp/>=<sp/>numpy.cos(angles)</highlight></codeline>
<codeline lineno="857"><highlight class="normal"><sp/><sp/><sp/><sp/>co<sp/>=<sp/>(cosa<sp/>*<sp/>cosb<sp/>-<sp/>cosg)<sp/>/<sp/>(sina<sp/>*<sp/>sinb)</highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array((</highlight></codeline>
<codeline lineno="859"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/>a*sinb*math.sqrt(1.0-co*co),<sp/><sp/>0.0,<sp/><sp/><sp/><sp/>0.0,<sp/>0.0),</highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(-a*sinb*co,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b*sina,<sp/>0.0,<sp/>0.0),</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/>a*cosb,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>b*cosa,<sp/>c,<sp/><sp/><sp/>0.0),</highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/>0.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/>0.0,<sp/>1.0)),</highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="864"><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"></highlight></codeline>
<codeline lineno="866"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">superimposition_matrix(v0,<sp/>v1,<sp/>scaling=False,<sp/>usesvd=True):</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>matrix<sp/>to<sp/>transform<sp/>given<sp/>vector<sp/>set<sp/>into<sp/>second<sp/>vector<sp/>set.</highlight></codeline>
<codeline lineno="868"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="869"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>v0<sp/>and<sp/>v1<sp/>are<sp/>shape<sp/>(3,<sp/>\*)<sp/>or<sp/>(4,<sp/>\*)<sp/>arrays<sp/>of<sp/>at<sp/>least<sp/>3<sp/>vectors.</highlight></codeline>
<codeline lineno="870"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="871"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>If<sp/>usesvd<sp/>is<sp/>True,<sp/>the<sp/>weighted<sp/>sum<sp/>of<sp/>squared<sp/>deviations<sp/>(RMSD)<sp/>is</highlight></codeline>
<codeline lineno="872"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>minimized<sp/>according<sp/>to<sp/>the<sp/>algorithm<sp/>by<sp/>W.<sp/>Kabsch<sp/>[8].<sp/>Otherwise<sp/>the</highlight></codeline>
<codeline lineno="873"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>quaternion<sp/>based<sp/>algorithm<sp/>by<sp/>B.<sp/>Horn<sp/>[9]<sp/>is<sp/>used<sp/>(slower<sp/>when<sp/>using</highlight></codeline>
<codeline lineno="874"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>this<sp/>Python<sp/>implementation).</highlight></codeline>
<codeline lineno="875"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="876"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>The<sp/>returned<sp/>matrix<sp/>performs<sp/>rotation,<sp/>translation<sp/>and<sp/>uniform<sp/>scaling</highlight></codeline>
<codeline lineno="877"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>(if<sp/>specified).</highlight></codeline>
<codeline lineno="878"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="879"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>numpy.random.rand(3,<sp/>10)</highlight></codeline>
<codeline lineno="880"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>superimposition_matrix(v0,<sp/>v0)</highlight></codeline>
<codeline lineno="881"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(M,<sp/>numpy.identity(4))</highlight></codeline>
<codeline lineno="882"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="883"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>random_rotation_matrix(numpy.random.random(3))</highlight></codeline>
<codeline lineno="884"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>((1,0,0),<sp/>(0,1,0),<sp/>(0,0,1),<sp/>(1,1,1))</highlight></codeline>
<codeline lineno="885"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>numpy.dot(R,<sp/>v0)</highlight></codeline>
<codeline lineno="886"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>superimposition_matrix(v0,<sp/>v1)</highlight></codeline>
<codeline lineno="887"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>numpy.dot(M,<sp/>v0))</highlight></codeline>
<codeline lineno="888"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="889"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>(numpy.random.rand(4,<sp/>100)<sp/>-<sp/>0.5)<sp/>*<sp/>20.0</highlight></codeline>
<codeline lineno="890"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0[3]<sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="891"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>numpy.dot(R,<sp/>v0)</highlight></codeline>
<codeline lineno="892"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>superimposition_matrix(v0,<sp/>v1)</highlight></codeline>
<codeline lineno="893"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>numpy.dot(M,<sp/>v0))</highlight></codeline>
<codeline lineno="894"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="895"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>S<sp/>=<sp/>scale_matrix(random.random())</highlight></codeline>
<codeline lineno="896"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>T<sp/>=<sp/>translation_matrix(numpy.random.random(3)-0.5)</highlight></codeline>
<codeline lineno="897"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>concatenate_matrices(T,<sp/>R,<sp/>S)</highlight></codeline>
<codeline lineno="898"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>numpy.dot(M,<sp/>v0)</highlight></codeline>
<codeline lineno="899"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0[:3]<sp/>+=<sp/>numpy.random.normal(0.0,<sp/>1e-9,<sp/>300).reshape(3,<sp/>-1)</highlight></codeline>
<codeline lineno="900"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>superimposition_matrix(v0,<sp/>v1,<sp/>scaling=True)</highlight></codeline>
<codeline lineno="901"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>numpy.dot(M,<sp/>v0))</highlight></codeline>
<codeline lineno="902"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="903"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>superimposition_matrix(v0,<sp/>v1,<sp/>scaling=True,<sp/>usesvd=False)</highlight></codeline>
<codeline lineno="904"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>numpy.dot(M,<sp/>v0))</highlight></codeline>
<codeline lineno="905"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="906"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>numpy.empty((4,<sp/>100,<sp/>3),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="907"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v[:,<sp/>:,<sp/>0]<sp/>=<sp/>v0</highlight></codeline>
<codeline lineno="908"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>superimposition_matrix(v0,<sp/>v1,<sp/>scaling=True,<sp/>usesvd=False)</highlight></codeline>
<codeline lineno="909"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>numpy.dot(M,<sp/>v[:,<sp/>:,<sp/>0]))</highlight></codeline>
<codeline lineno="910"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="911"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="912"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/>v0<sp/>=<sp/>numpy.array(v0,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)[:3]</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/>v1<sp/>=<sp/>numpy.array(v1,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)[:3]</highlight></codeline>
<codeline lineno="915"><highlight class="normal"></highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>v0.shape<sp/>!=<sp/>v1.shape<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>v0.shape[1]<sp/>&lt;<sp/>3:</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;Vector<sp/>sets<sp/>are<sp/>of<sp/>wrong<sp/>shape<sp/>or<sp/>type.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="918"><highlight class="normal"></highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>move<sp/>centroids<sp/>to<sp/>origin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/>t0<sp/>=<sp/>numpy.mean(v0,<sp/>axis=1)</highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/><sp/><sp/>t1<sp/>=<sp/>numpy.mean(v1,<sp/>axis=1)</highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/>v0<sp/>=<sp/>v0<sp/>-<sp/>t0.reshape(3,<sp/>1)</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/>v1<sp/>=<sp/>v1<sp/>-<sp/>t1.reshape(3,<sp/>1)</highlight></codeline>
<codeline lineno="924"><highlight class="normal"></highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>usesvd:</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Singular<sp/>Value<sp/>Decomposition<sp/>of<sp/>covariance<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u,<sp/>s,<sp/>vh<sp/>=<sp/>numpy.linalg.svd(numpy.dot(v1,<sp/>v0.T))</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>rotation<sp/>matrix<sp/>from<sp/>SVD<sp/>orthonormal<sp/>bases</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>R<sp/>=<sp/>numpy.dot(u,<sp/>vh)</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>numpy.linalg.det(R)<sp/>&lt;<sp/>0.0:</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>R<sp/>does<sp/>not<sp/>constitute<sp/>right<sp/>handed<sp/>system</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>R<sp/>-=<sp/>numpy.outer(u[:,<sp/>2],<sp/>vh[2,<sp/>:]*2.0)</highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s[-1]<sp/>*=<sp/>-1.0</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>homogeneous<sp/>transformation<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>=<sp/>R</highlight></codeline>
<codeline lineno="937"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>compute<sp/>symmetric<sp/>matrix<sp/>N</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xx,<sp/>yy,<sp/>zz<sp/>=<sp/>numpy.sum(v0<sp/>*<sp/>v1,<sp/>axis=1)</highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xy,<sp/>yz,<sp/>zx<sp/>=<sp/>numpy.sum(v0<sp/>*<sp/>numpy.roll(v1,<sp/>-1,<sp/>axis=0),<sp/>axis=1)</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xz,<sp/>yx,<sp/>zy<sp/>=<sp/>numpy.sum(v0<sp/>*<sp/>numpy.roll(v1,<sp/>-2,<sp/>axis=0),<sp/>axis=1)</highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>N<sp/>=<sp/>((xx+yy+zz,<sp/>yz-zy,<sp/><sp/><sp/><sp/>zx-xz,<sp/><sp/><sp/><sp/>xy-yx),</highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(yz-zy,<sp/><sp/><sp/><sp/>xx-yy-zz,<sp/>xy+yx,<sp/><sp/><sp/><sp/>zx+xz),</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(zx-xz,<sp/><sp/><sp/><sp/>xy+yx,<sp/><sp/><sp/>-xx+yy-zz,<sp/>yz+zy),</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(xy-yx,<sp/><sp/><sp/><sp/>zx+xz,<sp/><sp/><sp/><sp/>yz+zy,<sp/><sp/><sp/>-xx-yy+zz))</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>quaternion:<sp/>eigenvector<sp/>corresponding<sp/>to<sp/>most<sp/>positive<sp/>eigenvalue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l,<sp/>V<sp/>=<sp/>numpy.linalg.eig(N)</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q<sp/>=<sp/>V[:,<sp/>numpy.argmax(l)]</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q<sp/>/=<sp/>vector_norm(q)<sp/></highlight><highlight class="comment">#<sp/>unit<sp/>quaternion</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="950"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q<sp/>=<sp/>numpy.roll(q,<sp/>-1)<sp/></highlight><highlight class="comment">#<sp/>move<sp/>w<sp/>component<sp/>to<sp/>end</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>homogeneous<sp/>transformation<sp/>matrix</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>quaternion_matrix(q)</highlight></codeline>
<codeline lineno="953"><highlight class="normal"></highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>scale:<sp/>ratio<sp/>of<sp/>rms<sp/>deviations<sp/>from<sp/>centroid</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>scaling:</highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v0<sp/>*=<sp/>v0</highlight></codeline>
<codeline lineno="957"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v1<sp/>*=<sp/>v1</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[:3,<sp/>:3]<sp/>*=<sp/>math.sqrt(numpy.sum(v1)<sp/>/<sp/>numpy.sum(v0))</highlight></codeline>
<codeline lineno="959"><highlight class="normal"></highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>translation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/><sp/><sp/>M[:3,<sp/>3]<sp/>=<sp/>t1</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/>T<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/>T[:3,<sp/>3]<sp/>=<sp/>-t0</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.dot(M,<sp/>T)</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="966"><highlight class="normal"></highlight></codeline>
<codeline lineno="967"><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">euler_matrix(ai,<sp/>aj,<sp/>ak,<sp/>axes=&apos;sxyz&apos;):</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>homogeneous<sp/>rotation<sp/>matrix<sp/>from<sp/>Euler<sp/>angles<sp/>and<sp/>axis<sp/>sequence.</highlight></codeline>
<codeline lineno="970"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="971"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ai,<sp/>aj,<sp/>ak<sp/>:<sp/>Euler&apos;s<sp/>roll,<sp/>pitch<sp/>and<sp/>yaw<sp/>angles</highlight></codeline>
<codeline lineno="972"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>axes<sp/>:<sp/>One<sp/>of<sp/>24<sp/>axis<sp/>sequences<sp/>as<sp/>string<sp/>or<sp/>encoded<sp/>tuple</highlight></codeline>
<codeline lineno="973"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="974"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>euler_matrix(1,<sp/>2,<sp/>3,<sp/>&apos;syxz&apos;)</highlight></codeline>
<codeline lineno="975"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.sum(R[0]),<sp/>-1.34786452)</highlight></codeline>
<codeline lineno="976"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="977"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>euler_matrix(1,<sp/>2,<sp/>3,<sp/>(0,<sp/>1,<sp/>0,<sp/>1))</highlight></codeline>
<codeline lineno="978"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.sum(R[0]),<sp/>-0.383436184)</highlight></codeline>
<codeline lineno="979"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="980"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ai,<sp/>aj,<sp/>ak<sp/>=<sp/>(4.0*math.pi)<sp/>*<sp/>(numpy.random.random(3)<sp/>-<sp/>0.5)</highlight></codeline>
<codeline lineno="981"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>for<sp/>axes<sp/>in<sp/>_AXES2TUPLE.keys():</highlight></codeline>
<codeline lineno="982"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/>R<sp/>=<sp/>euler_matrix(ai,<sp/>aj,<sp/>ak,<sp/>axes)</highlight></codeline>
<codeline lineno="983"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>for<sp/>axes<sp/>in<sp/>_TUPLE2AXES.keys():</highlight></codeline>
<codeline lineno="984"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/>R<sp/>=<sp/>euler_matrix(ai,<sp/>aj,<sp/>ak,<sp/>axes)</highlight></codeline>
<codeline lineno="985"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="986"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>firstaxis,<sp/>parity,<sp/>repetition,<sp/>frame<sp/>=<sp/>_AXES2TUPLE[axes]</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>(AttributeError,<sp/>KeyError):</highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_<sp/>=<sp/>_TUPLE2AXES[axes]</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>firstaxis,<sp/>parity,<sp/>repetition,<sp/>frame<sp/>=<sp/>axes</highlight></codeline>
<codeline lineno="992"><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>firstaxis</highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/>j<sp/>=<sp/>_NEXT_AXIS[i+parity]</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/>k<sp/>=<sp/>_NEXT_AXIS[i-parity+1]</highlight></codeline>
<codeline lineno="996"><highlight class="normal"></highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>frame:</highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ai,<sp/>ak<sp/>=<sp/>ak,<sp/>ai</highlight></codeline>
<codeline lineno="999"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>parity:</highlight></codeline>
<codeline lineno="1000"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ai,<sp/>aj,<sp/>ak<sp/>=<sp/>-ai,<sp/>-aj,<sp/>-ak</highlight></codeline>
<codeline lineno="1001"><highlight class="normal"></highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/>si,<sp/>sj,<sp/>sk<sp/>=<sp/>math.sin(ai),<sp/>math.sin(aj),<sp/>math.sin(ak)</highlight></codeline>
<codeline lineno="1003"><highlight class="normal"><sp/><sp/><sp/><sp/>ci,<sp/>cj,<sp/>ck<sp/>=<sp/>math.cos(ai),<sp/>math.cos(aj),<sp/>math.cos(ak)</highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/><sp/><sp/>cc,<sp/>cs<sp/>=<sp/>ci*ck,<sp/>ci*sk</highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/>sc,<sp/>ss<sp/>=<sp/>si*ck,<sp/>si*sk</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>repetition:</highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>i]<sp/>=<sp/>cj</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>j]<sp/>=<sp/>sj*si</highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>k]<sp/>=<sp/>sj*ci</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[j,<sp/>i]<sp/>=<sp/>sj*sk</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[j,<sp/>j]<sp/>=<sp/>-cj*ss+cc</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[j,<sp/>k]<sp/>=<sp/>-cj*cs-sc</highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[k,<sp/>i]<sp/>=<sp/>-sj*ck</highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[k,<sp/>j]<sp/>=<sp/>cj*sc+cs</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[k,<sp/>k]<sp/>=<sp/>cj*cc-ss</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>i]<sp/>=<sp/>cj*ck</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>j]<sp/>=<sp/>sj*sc-cs</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>k]<sp/>=<sp/>sj*cc+ss</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[j,<sp/>i]<sp/>=<sp/>cj*sk</highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[j,<sp/>j]<sp/>=<sp/>sj*ss+cc</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[j,<sp/>k]<sp/>=<sp/>sj*cs-sc</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[k,<sp/>i]<sp/>=<sp/>-sj</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[k,<sp/>j]<sp/>=<sp/>cj*si</highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[k,<sp/>k]<sp/>=<sp/>cj*ci</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="1029"><highlight class="normal"></highlight></codeline>
<codeline lineno="1030"><highlight class="normal"></highlight></codeline>
<codeline lineno="1031"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">euler_from_matrix(matrix,<sp/>axes=&apos;sxyz&apos;):</highlight></codeline>
<codeline lineno="1032"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>Euler<sp/>angles<sp/>from<sp/>rotation<sp/>matrix<sp/>for<sp/>specified<sp/>axis<sp/>sequence.</highlight></codeline>
<codeline lineno="1033"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1034"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>axes<sp/>:<sp/>One<sp/>of<sp/>24<sp/>axis<sp/>sequences<sp/>as<sp/>string<sp/>or<sp/>encoded<sp/>tuple</highlight></codeline>
<codeline lineno="1035"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1036"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Note<sp/>that<sp/>many<sp/>Euler<sp/>angle<sp/>triplets<sp/>can<sp/>describe<sp/>one<sp/>matrix.</highlight></codeline>
<codeline lineno="1037"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1038"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R0<sp/>=<sp/>euler_matrix(1,<sp/>2,<sp/>3,<sp/>&apos;syxz&apos;)</highlight></codeline>
<codeline lineno="1039"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>al,<sp/>be,<sp/>ga<sp/>=<sp/>euler_from_matrix(R0,<sp/>&apos;syxz&apos;)</highlight></codeline>
<codeline lineno="1040"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R1<sp/>=<sp/>euler_matrix(al,<sp/>be,<sp/>ga,<sp/>&apos;syxz&apos;)</highlight></codeline>
<codeline lineno="1041"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(R0,<sp/>R1)</highlight></codeline>
<codeline lineno="1042"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1043"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angles<sp/>=<sp/>(4.0*math.pi)<sp/>*<sp/>(numpy.random.random(3)<sp/>-<sp/>0.5)</highlight></codeline>
<codeline lineno="1044"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>for<sp/>axes<sp/>in<sp/>_AXES2TUPLE.keys():</highlight></codeline>
<codeline lineno="1045"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/>R0<sp/>=<sp/>euler_matrix(axes=axes,<sp/>*angles)</highlight></codeline>
<codeline lineno="1046"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/>R1<sp/>=<sp/>euler_matrix(axes=axes,<sp/>*euler_from_matrix(R0,<sp/>axes))</highlight></codeline>
<codeline lineno="1047"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/>if<sp/>not<sp/>numpy.allclose(R0,<sp/>R1):<sp/>print<sp/>axes,<sp/>&quot;failed&quot;</highlight></codeline>
<codeline lineno="1048"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1049"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>firstaxis,<sp/>parity,<sp/>repetition,<sp/>frame<sp/>=<sp/>_AXES2TUPLE[axes.lower()]</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>(AttributeError,<sp/>KeyError):</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_<sp/>=<sp/>_TUPLE2AXES[axes]</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>firstaxis,<sp/>parity,<sp/>repetition,<sp/>frame<sp/>=<sp/>axes</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"></highlight></codeline>
<codeline lineno="1056"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>firstaxis</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/>j<sp/>=<sp/>_NEXT_AXIS[i+parity]</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"><sp/><sp/><sp/><sp/>k<sp/>=<sp/>_NEXT_AXIS[i-parity+1]</highlight></codeline>
<codeline lineno="1059"><highlight class="normal"></highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)[:3,<sp/>:3]</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>repetition:</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sy<sp/>=<sp/>math.sqrt(M[i,<sp/>j]*M[i,<sp/>j]<sp/>+<sp/>M[i,<sp/>k]*M[i,<sp/>k])</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>sy<sp/>&gt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ax<sp/>=<sp/>math.atan2(<sp/>M[i,<sp/>j],<sp/><sp/>M[i,<sp/>k])</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ay<sp/>=<sp/>math.atan2(<sp/>sy,<sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>i])</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>az<sp/>=<sp/>math.atan2(<sp/>M[j,<sp/>i],<sp/>-M[k,<sp/>i])</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ax<sp/>=<sp/>math.atan2(-M[j,<sp/>k],<sp/><sp/>M[j,<sp/>j])</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ay<sp/>=<sp/>math.atan2(<sp/>sy,<sp/><sp/><sp/><sp/><sp/><sp/><sp/>M[i,<sp/>i])</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>az<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cy<sp/>=<sp/>math.sqrt(M[i,<sp/>i]*M[i,<sp/>i]<sp/>+<sp/>M[j,<sp/>i]*M[j,<sp/>i])</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>cy<sp/>&gt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ax<sp/>=<sp/>math.atan2(<sp/>M[k,<sp/>j],<sp/><sp/>M[k,<sp/>k])</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ay<sp/>=<sp/>math.atan2(-M[k,<sp/>i],<sp/><sp/>cy)</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>az<sp/>=<sp/>math.atan2(<sp/>M[j,<sp/>i],<sp/><sp/>M[i,<sp/>i])</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ax<sp/>=<sp/>math.atan2(-M[j,<sp/>k],<sp/><sp/>M[j,<sp/>j])</highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ay<sp/>=<sp/>math.atan2(-M[k,<sp/>i],<sp/><sp/>cy)</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>az<sp/>=<sp/>0.0</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"></highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>parity:</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ax,<sp/>ay,<sp/>az<sp/>=<sp/>-ax,<sp/>-ay,<sp/>-az</highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>frame:</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ax,<sp/>az<sp/>=<sp/>az,<sp/>ax</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ax,<sp/>ay,<sp/>az</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"></highlight></codeline>
<codeline lineno="1089"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">euler_from_quaternion(quaternion,<sp/>axes=&apos;sxyz&apos;):</highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>Euler<sp/>angles<sp/>from<sp/>quaternion<sp/>for<sp/>specified<sp/>axis<sp/>sequence.</highlight></codeline>
<codeline lineno="1091"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1092"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angles<sp/>=<sp/>euler_from_quaternion([0.06146124,<sp/>0,<sp/>0,<sp/>0.99810947])</highlight></codeline>
<codeline lineno="1093"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(angles,<sp/>[0.123,<sp/>0,<sp/>0])</highlight></codeline>
<codeline lineno="1094"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1095"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1096"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>euler_from_matrix(quaternion_matrix(quaternion),<sp/>axes)</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"></highlight></codeline>
<codeline lineno="1099"><highlight class="normal"></highlight></codeline>
<codeline lineno="1100"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_from_euler(ai,<sp/>aj,<sp/>ak,<sp/>axes=&apos;sxyz&apos;):</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>quaternion<sp/>from<sp/>Euler<sp/>angles<sp/>and<sp/>axis<sp/>sequence.</highlight></codeline>
<codeline lineno="1102"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1103"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>ai,<sp/>aj,<sp/>ak<sp/>:<sp/>Euler&apos;s<sp/>roll,<sp/>pitch<sp/>and<sp/>yaw<sp/>angles</highlight></codeline>
<codeline lineno="1104"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>axes<sp/>:<sp/>One<sp/>of<sp/>24<sp/>axis<sp/>sequences<sp/>as<sp/>string<sp/>or<sp/>encoded<sp/>tuple</highlight></codeline>
<codeline lineno="1105"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1106"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_from_euler(1,<sp/>2,<sp/>3,<sp/>&apos;ryxz&apos;)</highlight></codeline>
<codeline lineno="1107"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(q,<sp/>[0.310622,<sp/>-0.718287,<sp/>0.444435,<sp/>0.435953])</highlight></codeline>
<codeline lineno="1108"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1109"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1110"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>firstaxis,<sp/>parity,<sp/>repetition,<sp/>frame<sp/>=<sp/>_AXES2TUPLE[axes.lower()]</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>(AttributeError,<sp/>KeyError):</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>_<sp/>=<sp/>_TUPLE2AXES[axes]</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>firstaxis,<sp/>parity,<sp/>repetition,<sp/>frame<sp/>=<sp/>axes</highlight></codeline>
<codeline lineno="1116"><highlight class="normal"></highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>firstaxis</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"><sp/><sp/><sp/><sp/>j<sp/>=<sp/>_NEXT_AXIS[i+parity]</highlight></codeline>
<codeline lineno="1119"><highlight class="normal"><sp/><sp/><sp/><sp/>k<sp/>=<sp/>_NEXT_AXIS[i-parity+1]</highlight></codeline>
<codeline lineno="1120"><highlight class="normal"></highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>frame:</highlight></codeline>
<codeline lineno="1122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ai,<sp/>ak<sp/>=<sp/>ak,<sp/>ai</highlight></codeline>
<codeline lineno="1123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>parity:</highlight></codeline>
<codeline lineno="1124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aj<sp/>=<sp/>-aj</highlight></codeline>
<codeline lineno="1125"><highlight class="normal"></highlight></codeline>
<codeline lineno="1126"><highlight class="normal"><sp/><sp/><sp/><sp/>ai<sp/>/=<sp/>2.0</highlight></codeline>
<codeline lineno="1127"><highlight class="normal"><sp/><sp/><sp/><sp/>aj<sp/>/=<sp/>2.0</highlight></codeline>
<codeline lineno="1128"><highlight class="normal"><sp/><sp/><sp/><sp/>ak<sp/>/=<sp/>2.0</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/>ci<sp/>=<sp/>math.cos(ai)</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/>si<sp/>=<sp/>math.sin(ai)</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/><sp/><sp/>cj<sp/>=<sp/>math.cos(aj)</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/>sj<sp/>=<sp/>math.sin(aj)</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/>ck<sp/>=<sp/>math.cos(ak)</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/><sp/><sp/>sk<sp/>=<sp/>math.sin(ak)</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"><sp/><sp/><sp/><sp/>cc<sp/>=<sp/>ci*ck</highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/><sp/><sp/>cs<sp/>=<sp/>ci*sk</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"><sp/><sp/><sp/><sp/>sc<sp/>=<sp/>si*ck</highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/><sp/><sp/>ss<sp/>=<sp/>si*sk</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"></highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/><sp/><sp/>quaternion<sp/>=<sp/>numpy.empty((4,<sp/>),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>repetition:</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[i]<sp/>=<sp/>cj*(cs<sp/>+<sp/>sc)</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[j]<sp/>=<sp/>sj*(cc<sp/>+<sp/>ss)</highlight></codeline>
<codeline lineno="1144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[k]<sp/>=<sp/>sj*(cs<sp/>-<sp/>sc)</highlight></codeline>
<codeline lineno="1145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[3]<sp/>=<sp/>cj*(cc<sp/>-<sp/>ss)</highlight></codeline>
<codeline lineno="1146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[i]<sp/>=<sp/>cj*sc<sp/>-<sp/>sj*cs</highlight></codeline>
<codeline lineno="1148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[j]<sp/>=<sp/>cj*ss<sp/>+<sp/>sj*cc</highlight></codeline>
<codeline lineno="1149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[k]<sp/>=<sp/>cj*cs<sp/>-<sp/>sj*sc</highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[3]<sp/>=<sp/>cj*cc<sp/>+<sp/>sj*ss</highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>parity:</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion[j]<sp/>*=<sp/>-1</highlight></codeline>
<codeline lineno="1153"><highlight class="normal"></highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>quaternion</highlight></codeline>
<codeline lineno="1155"><highlight class="normal"></highlight></codeline>
<codeline lineno="1156"><highlight class="normal"></highlight></codeline>
<codeline lineno="1157"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_about_axis(angle,<sp/>axis):</highlight></codeline>
<codeline lineno="1158"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>quaternion<sp/>for<sp/>rotation<sp/>about<sp/>axis.</highlight></codeline>
<codeline lineno="1159"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1160"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_about_axis(0.123,<sp/>(1,<sp/>0,<sp/>0))</highlight></codeline>
<codeline lineno="1161"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(q,<sp/>[0.06146124,<sp/>0,<sp/>0,<sp/>0.99810947])</highlight></codeline>
<codeline lineno="1162"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1163"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1164"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/><sp/><sp/>quaternion<sp/>=<sp/>numpy.zeros((4,<sp/>),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"><sp/><sp/><sp/><sp/>quaternion[:3]<sp/>=<sp/>axis[:3]</highlight></codeline>
<codeline lineno="1167"><highlight class="normal"><sp/><sp/><sp/><sp/>qlen<sp/>=<sp/>vector_norm(quaternion)</highlight></codeline>
<codeline lineno="1168"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>qlen<sp/>&gt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>quaternion<sp/>*=<sp/>math.sin(angle/2.0)<sp/>/<sp/>qlen</highlight></codeline>
<codeline lineno="1170"><highlight class="normal"><sp/><sp/><sp/><sp/>quaternion[3]<sp/>=<sp/>math.cos(angle/2.0)</highlight></codeline>
<codeline lineno="1171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>quaternion</highlight></codeline>
<codeline lineno="1172"><highlight class="normal"></highlight></codeline>
<codeline lineno="1173"><highlight class="normal"></highlight></codeline>
<codeline lineno="1174"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_matrix(quaternion):</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>homogeneous<sp/>rotation<sp/>matrix<sp/>from<sp/>quaternion.</highlight></codeline>
<codeline lineno="1176"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1177"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>quaternion_matrix([0.06146124,<sp/>0,<sp/>0,<sp/>0.99810947])</highlight></codeline>
<codeline lineno="1178"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(R,<sp/>rotation_matrix(0.123,<sp/>(1,<sp/>0,<sp/>0)))</highlight></codeline>
<codeline lineno="1179"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1180"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1181"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1182"><highlight class="normal"><sp/><sp/><sp/><sp/>q<sp/>=<sp/>numpy.array(quaternion[:4],<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1183"><highlight class="normal"><sp/><sp/><sp/><sp/>nq<sp/>=<sp/>numpy.dot(q,<sp/>q)</highlight></codeline>
<codeline lineno="1184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>nq<sp/>&lt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="1186"><highlight class="normal"><sp/><sp/><sp/><sp/>q<sp/>*=<sp/>math.sqrt(2.0<sp/>/<sp/>nq)</highlight></codeline>
<codeline lineno="1187"><highlight class="normal"><sp/><sp/><sp/><sp/>q<sp/>=<sp/>numpy.outer(q,<sp/>q)</highlight></codeline>
<codeline lineno="1188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array((</highlight></codeline>
<codeline lineno="1189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(1.0-q[1,<sp/>1]-q[2,<sp/>2],<sp/><sp/><sp/><sp/><sp/>q[0,<sp/>1]-q[2,<sp/>3],<sp/><sp/><sp/><sp/><sp/>q[0,<sp/>2]+q[1,<sp/>3],<sp/>0.0),</highlight></codeline>
<codeline lineno="1190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/><sp/><sp/><sp/>q[0,<sp/>1]+q[2,<sp/>3],<sp/>1.0-q[0,<sp/>0]-q[2,<sp/>2],<sp/><sp/><sp/><sp/><sp/>q[1,<sp/>2]-q[0,<sp/>3],<sp/>0.0),</highlight></codeline>
<codeline lineno="1191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/><sp/><sp/><sp/>q[0,<sp/>2]-q[1,<sp/>3],<sp/><sp/><sp/><sp/><sp/>q[1,<sp/>2]+q[0,<sp/>3],<sp/>1.0-q[0,<sp/>0]-q[1,<sp/>1],<sp/>0.0),</highlight></codeline>
<codeline lineno="1192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0,<sp/>1.0)</highlight></codeline>
<codeline lineno="1193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1194"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195"><highlight class="normal"></highlight></codeline>
<codeline lineno="1196"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_from_matrix(matrix):</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>quaternion<sp/>from<sp/>rotation<sp/>matrix.</highlight></codeline>
<codeline lineno="1198"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1199"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>rotation_matrix(0.123,<sp/>(1,<sp/>2,<sp/>3))</highlight></codeline>
<codeline lineno="1200"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_from_matrix(R)</highlight></codeline>
<codeline lineno="1201"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(q,<sp/>[0.0164262,<sp/>0.0328524,<sp/>0.0492786,<sp/>0.9981095])</highlight></codeline>
<codeline lineno="1202"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1203"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1204"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1205"><highlight class="normal"><sp/><sp/><sp/><sp/>q<sp/>=<sp/>numpy.empty((4,<sp/>),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1206"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.array(matrix,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)[:4,<sp/>:4]</highlight></codeline>
<codeline lineno="1207"><highlight class="normal"><sp/><sp/><sp/><sp/>t<sp/>=<sp/>numpy.trace(M)</highlight></codeline>
<codeline lineno="1208"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>t<sp/>&gt;<sp/>M[3,<sp/>3]:</highlight></codeline>
<codeline lineno="1209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[3]<sp/>=<sp/>t</highlight></codeline>
<codeline lineno="1210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[2]<sp/>=<sp/>M[1,<sp/>0]<sp/>-<sp/>M[0,<sp/>1]</highlight></codeline>
<codeline lineno="1211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[1]<sp/>=<sp/>M[0,<sp/>2]<sp/>-<sp/>M[2,<sp/>0]</highlight></codeline>
<codeline lineno="1212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[0]<sp/>=<sp/>M[2,<sp/>1]<sp/>-<sp/>M[1,<sp/>2]</highlight></codeline>
<codeline lineno="1213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i,<sp/>j,<sp/>k<sp/>=<sp/>0,<sp/>1,<sp/>2</highlight></codeline>
<codeline lineno="1215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>M[1,<sp/>1]<sp/>&gt;<sp/>M[0,<sp/>0]:</highlight></codeline>
<codeline lineno="1216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i,<sp/>j,<sp/>k<sp/>=<sp/>1,<sp/>2,<sp/>0</highlight></codeline>
<codeline lineno="1217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>M[2,<sp/>2]<sp/>&gt;<sp/>M[i,<sp/>i]:</highlight></codeline>
<codeline lineno="1218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i,<sp/>j,<sp/>k<sp/>=<sp/>2,<sp/>0,<sp/>1</highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t<sp/>=<sp/>M[i,<sp/>i]<sp/>-<sp/>(M[j,<sp/>j]<sp/>+<sp/>M[k,<sp/>k])<sp/>+<sp/>M[3,<sp/>3]</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[i]<sp/>=<sp/>t</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[j]<sp/>=<sp/>M[i,<sp/>j]<sp/>+<sp/>M[j,<sp/>i]</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[k]<sp/>=<sp/>M[k,<sp/>i]<sp/>+<sp/>M[i,<sp/>k]</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q[3]<sp/>=<sp/>M[k,<sp/>j]<sp/>-<sp/>M[j,<sp/>k]</highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/><sp/><sp/>q<sp/>*=<sp/>0.5<sp/>/<sp/>math.sqrt(t<sp/>*<sp/>M[3,<sp/>3])</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"></highlight></codeline>
<codeline lineno="1227"><highlight class="normal"></highlight></codeline>
<codeline lineno="1228"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_multiply(quaternion1,<sp/>quaternion0):</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>multiplication<sp/>of<sp/>two<sp/>quaternions.</highlight></codeline>
<codeline lineno="1230"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1231"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_multiply([1,<sp/>-2,<sp/>3,<sp/>4],<sp/>[-5,<sp/>6,<sp/>7,<sp/>8])</highlight></codeline>
<codeline lineno="1232"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(q,<sp/>[-44,<sp/>-14,<sp/>48,<sp/>28])</highlight></codeline>
<codeline lineno="1233"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1234"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1235"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/>x0,<sp/>y0,<sp/>z0,<sp/>w0<sp/>=<sp/>quaternion0</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/>x1,<sp/>y1,<sp/>z1,<sp/>w1<sp/>=<sp/>quaternion1</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array((</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x1*w0<sp/>+<sp/>y1*z0<sp/>-<sp/>z1*y0<sp/>+<sp/>w1*x0,</highlight></codeline>
<codeline lineno="1240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-x1*z0<sp/>+<sp/>y1*w0<sp/>+<sp/>z1*x0<sp/>+<sp/>w1*y0,</highlight></codeline>
<codeline lineno="1241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x1*y0<sp/>-<sp/>y1*x0<sp/>+<sp/>z1*w0<sp/>+<sp/>w1*z0,</highlight></codeline>
<codeline lineno="1242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-x1*x0<sp/>-<sp/>y1*y0<sp/>-<sp/>z1*z0<sp/>+<sp/>w1*w0),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1243"><highlight class="normal"></highlight></codeline>
<codeline lineno="1244"><highlight class="normal"></highlight></codeline>
<codeline lineno="1245"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_conjugate(quaternion):</highlight></codeline>
<codeline lineno="1246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>conjugate<sp/>of<sp/>quaternion.</highlight></codeline>
<codeline lineno="1247"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1248"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q0<sp/>=<sp/>random_quaternion()</highlight></codeline>
<codeline lineno="1249"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q1<sp/>=<sp/>quaternion_conjugate(q0)</highlight></codeline>
<codeline lineno="1250"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q1[3]<sp/>==<sp/>q0[3]<sp/>and<sp/>all(q1[:3]<sp/>==<sp/>-q0[:3])</highlight></codeline>
<codeline lineno="1251"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1252"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1253"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array((-quaternion[0],<sp/>-quaternion[1],</highlight></codeline>
<codeline lineno="1255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-quaternion[2],<sp/>quaternion[3]),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1256"><highlight class="normal"></highlight></codeline>
<codeline lineno="1257"><highlight class="normal"></highlight></codeline>
<codeline lineno="1258"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_inverse(quaternion):</highlight></codeline>
<codeline lineno="1259"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>inverse<sp/>of<sp/>quaternion.</highlight></codeline>
<codeline lineno="1260"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1261"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q0<sp/>=<sp/>random_quaternion()</highlight></codeline>
<codeline lineno="1262"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q1<sp/>=<sp/>quaternion_inverse(q0)</highlight></codeline>
<codeline lineno="1263"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(quaternion_multiply(q0,<sp/>q1),<sp/>[0,<sp/>0,<sp/>0,<sp/>1])</highlight></codeline>
<codeline lineno="1264"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1265"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1266"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>quaternion_conjugate(quaternion)<sp/>/<sp/>numpy.dot(quaternion,<sp/>quaternion)</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"></highlight></codeline>
<codeline lineno="1269"><highlight class="normal"></highlight></codeline>
<codeline lineno="1270"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">quaternion_slerp(quat0,<sp/>quat1,<sp/>fraction,<sp/>spin=0,<sp/>shortestpath=True):</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>spherical<sp/>linear<sp/>interpolation<sp/>between<sp/>two<sp/>quaternions.</highlight></codeline>
<codeline lineno="1272"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1273"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q0<sp/>=<sp/>random_quaternion()</highlight></codeline>
<codeline lineno="1274"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q1<sp/>=<sp/>random_quaternion()</highlight></codeline>
<codeline lineno="1275"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_slerp(q0,<sp/>q1,<sp/>0.0)</highlight></codeline>
<codeline lineno="1276"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(q,<sp/>q0)</highlight></codeline>
<codeline lineno="1277"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1278"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_slerp(q0,<sp/>q1,<sp/>1.0,<sp/>1)</highlight></codeline>
<codeline lineno="1279"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(q,<sp/>q1)</highlight></codeline>
<codeline lineno="1280"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1281"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>quaternion_slerp(q0,<sp/>q1,<sp/>0.5)</highlight></codeline>
<codeline lineno="1282"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>angle<sp/>=<sp/>math.acos(numpy.dot(q0,<sp/>q))</highlight></codeline>
<codeline lineno="1283"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(2.0,<sp/>math.acos(numpy.dot(q0,<sp/>q1))<sp/>/<sp/>angle)<sp/>or<sp/>\</highlight></codeline>
<codeline lineno="1284"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numpy.allclose(2.0,<sp/>math.acos(-numpy.dot(q0,<sp/>q1))<sp/>/<sp/>angle)</highlight></codeline>
<codeline lineno="1285"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1286"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1287"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1288"><highlight class="normal"><sp/><sp/><sp/><sp/>q0<sp/>=<sp/>unit_vector(quat0[:4])</highlight></codeline>
<codeline lineno="1289"><highlight class="normal"><sp/><sp/><sp/><sp/>q1<sp/>=<sp/>unit_vector(quat1[:4])</highlight></codeline>
<codeline lineno="1290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>fraction<sp/>==<sp/>0.0:</highlight></codeline>
<codeline lineno="1291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q0</highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>fraction<sp/>==<sp/>1.0:</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q1</highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/><sp/><sp/>d<sp/>=<sp/>numpy.dot(q0,<sp/>q1)</highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>abs(abs(d)<sp/>-<sp/>1.0)<sp/>&lt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q0</highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>shortestpath<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>d<sp/>&lt;<sp/>0.0:</highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>invert<sp/>rotation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d<sp/>=<sp/>-d</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q1<sp/>*=<sp/>-1.0</highlight></codeline>
<codeline lineno="1301"><highlight class="normal"><sp/><sp/><sp/><sp/>angle<sp/>=<sp/>math.acos(d)<sp/>+<sp/>spin<sp/>*<sp/>math.pi</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>abs(angle)<sp/>&lt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q0</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"><sp/><sp/><sp/><sp/>isin<sp/>=<sp/>1.0<sp/>/<sp/>math.sin(angle)</highlight></codeline>
<codeline lineno="1305"><highlight class="normal"><sp/><sp/><sp/><sp/>q0<sp/>*=<sp/>math.sin((1.0<sp/>-<sp/>fraction)<sp/>*<sp/>angle)<sp/>*<sp/>isin</highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/><sp/><sp/>q1<sp/>*=<sp/>math.sin(fraction<sp/>*<sp/>angle)<sp/>*<sp/>isin</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/><sp/><sp/>q0<sp/>+=<sp/>q1</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q0</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"></highlight></codeline>
<codeline lineno="1310"><highlight class="normal"></highlight></codeline>
<codeline lineno="1311"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">random_quaternion(rand=None):</highlight></codeline>
<codeline lineno="1312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>uniform<sp/>random<sp/>unit<sp/>quaternion.</highlight></codeline>
<codeline lineno="1313"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1314"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>rand:<sp/>array<sp/>like<sp/>or<sp/>None</highlight></codeline>
<codeline lineno="1315"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Three<sp/>independent<sp/>random<sp/>variables<sp/>that<sp/>are<sp/>uniformly<sp/>distributed</highlight></codeline>
<codeline lineno="1316"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>between<sp/>0<sp/>and<sp/>1.</highlight></codeline>
<codeline lineno="1317"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1318"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>random_quaternion()</highlight></codeline>
<codeline lineno="1319"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(1.0,<sp/>vector_norm(q))</highlight></codeline>
<codeline lineno="1320"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1321"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q<sp/>=<sp/>random_quaternion(numpy.random.random(3))</highlight></codeline>
<codeline lineno="1322"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>q.shape</highlight></codeline>
<codeline lineno="1323"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>(4,)</highlight></codeline>
<codeline lineno="1324"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1325"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1326"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>rand<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rand<sp/>=<sp/>numpy.random.rand(3)</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>len(rand)<sp/>==<sp/>3</highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/>r1<sp/>=<sp/>numpy.sqrt(1.0<sp/>-<sp/>rand[0])</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"><sp/><sp/><sp/><sp/>r2<sp/>=<sp/>numpy.sqrt(rand[0])</highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/>pi2<sp/>=<sp/>math.pi<sp/>*<sp/>2.0</highlight></codeline>
<codeline lineno="1333"><highlight class="normal"><sp/><sp/><sp/><sp/>t1<sp/>=<sp/>pi2<sp/>*<sp/>rand[1]</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/>t2<sp/>=<sp/>pi2<sp/>*<sp/>rand[2]</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array((numpy.sin(t1)*r1,</highlight></codeline>
<codeline lineno="1336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numpy.cos(t1)*r1,</highlight></codeline>
<codeline lineno="1337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numpy.sin(t2)*r2,</highlight></codeline>
<codeline lineno="1338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numpy.cos(t2)*r2),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1339"><highlight class="normal"></highlight></codeline>
<codeline lineno="1340"><highlight class="normal"></highlight></codeline>
<codeline lineno="1341"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">random_rotation_matrix(rand=None):</highlight></codeline>
<codeline lineno="1342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>uniform<sp/>random<sp/>rotation<sp/>matrix.</highlight></codeline>
<codeline lineno="1343"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1344"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>rnd:<sp/>array<sp/>like</highlight></codeline>
<codeline lineno="1345"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Three<sp/>independent<sp/>random<sp/>variables<sp/>that<sp/>are<sp/>uniformly<sp/>distributed</highlight></codeline>
<codeline lineno="1346"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>between<sp/>0<sp/>and<sp/>1<sp/>for<sp/>each<sp/>returned<sp/>quaternion.</highlight></codeline>
<codeline lineno="1347"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1348"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>random_rotation_matrix()</highlight></codeline>
<codeline lineno="1349"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.dot(R.T,<sp/>R),<sp/>numpy.identity(4))</highlight></codeline>
<codeline lineno="1350"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1351"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1352"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>quaternion_matrix(random_quaternion(rand))</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"></highlight></codeline>
<codeline lineno="1355"><highlight class="normal"></highlight></codeline>
<codeline lineno="1356" refid="classtf__quaternion_1_1transformations_1_1Arcball" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball" kindref="compound">Arcball</ref>(object):</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Virtual<sp/>Trackball<sp/>Control.</highlight></codeline>
<codeline lineno="1358"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1359"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball<sp/>=<sp/>Arcball()</highlight></codeline>
<codeline lineno="1360"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball<sp/>=<sp/>Arcball(initial=numpy.identity(4))</highlight></codeline>
<codeline lineno="1361"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.place([320,<sp/>320],<sp/>320)</highlight></codeline>
<codeline lineno="1362"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.down([500,<sp/>250])</highlight></codeline>
<codeline lineno="1363"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.drag([475,<sp/>275])</highlight></codeline>
<codeline lineno="1364"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>ball.matrix()</highlight></codeline>
<codeline lineno="1365"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.sum(R),<sp/>3.90583455)</highlight></codeline>
<codeline lineno="1366"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1367"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball<sp/>=<sp/>Arcball(initial=[0,<sp/>0,<sp/>0,<sp/>1])</highlight></codeline>
<codeline lineno="1368"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.place([320,<sp/>320],<sp/>320)</highlight></codeline>
<codeline lineno="1369"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.setaxes([1,1,0],<sp/>[-1,<sp/>1,<sp/>0])</highlight></codeline>
<codeline lineno="1370"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.setconstrain(True)</highlight></codeline>
<codeline lineno="1371"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.down([400,<sp/>200])</highlight></codeline>
<codeline lineno="1372"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.drag([200,<sp/>400])</highlight></codeline>
<codeline lineno="1373"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>R<sp/>=<sp/>ball.matrix()</highlight></codeline>
<codeline lineno="1374"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.sum(R),<sp/>0.2055924)</highlight></codeline>
<codeline lineno="1375"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1376"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>ball.next()</highlight></codeline>
<codeline lineno="1377"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1378"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1379"><highlight class="normal"></highlight></codeline>
<codeline lineno="1380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1601a290afef74788b0abfef850ce1d8" kindref="member">__init__</ref>(self,<sp/>initial=None):</highlight></codeline>
<codeline lineno="1381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Initialize<sp/>virtual<sp/>trackball<sp/>control.</highlight></codeline>
<codeline lineno="1382"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1383"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>initial<sp/>:<sp/>quaternion<sp/>or<sp/>rotation<sp/>matrix</highlight></codeline>
<codeline lineno="1384"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1385"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a60ba74ff0532693bd4f17305511f1ba9" kindref="member">_axis</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a38c8d595804ed99514eddb97f085c6eb" kindref="member">_axes</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ad16d39f5af820bf504b1ba7a815c3394" kindref="member">_radius</ref><sp/>=<sp/>1.0</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab1e8e28106f18d7e06515932e4aa51c2" kindref="member">_center</ref><sp/>=<sp/>[0.0,<sp/>0.0]</highlight></codeline>
<codeline lineno="1390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a425a773e487d2ff8e155d2abda08ed3c" kindref="member">_vdown</ref><sp/>=<sp/>numpy.array([0,<sp/>0,<sp/>1],<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab4e36944aa3b36adb8dd66c508ba464c" kindref="member">_constrain</ref><sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1392"><highlight class="normal"></highlight></codeline>
<codeline lineno="1393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>initial<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a53556780b35448f185b4f8b4ec948a7d" kindref="member">_qdown</ref><sp/>=<sp/>numpy.array([0,<sp/>0,<sp/>0,<sp/>1],<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>initial<sp/>=<sp/>numpy.array(initial,<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>initial.shape<sp/>==<sp/>(4,<sp/>4):</highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a53556780b35448f185b4f8b4ec948a7d" kindref="member">_qdown</ref><sp/>=<sp/>quaternion_from_matrix(initial)</highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>initial.shape<sp/>==<sp/>(4,<sp/>):</highlight></codeline>
<codeline lineno="1400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>initial<sp/>/=<sp/>vector_norm(initial)</highlight></codeline>
<codeline lineno="1401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a53556780b35448f185b4f8b4ec948a7d" kindref="member">_qdown</ref><sp/>=<sp/>initial</highlight></codeline>
<codeline lineno="1402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&quot;initial<sp/>not<sp/>a<sp/>quaternion<sp/>or<sp/>matrix.&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1404"><highlight class="normal"></highlight></codeline>
<codeline lineno="1405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref><sp/>=<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1afb1b380fdca25d52ed3f58df54a7b5fb" kindref="member">_qpre</ref><sp/>=<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a53556780b35448f185b4f8b4ec948a7d" kindref="member">_qdown</ref></highlight></codeline>
<codeline lineno="1406"><highlight class="normal"></highlight></codeline>
<codeline lineno="1407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a8e92f92a8d536fdaf74ad019ac6bb8b7" kindref="member">place</ref>(self,<sp/>center,<sp/>radius):</highlight></codeline>
<codeline lineno="1408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Place<sp/>Arcball,<sp/>e.g.<sp/>when<sp/>window<sp/>size<sp/>changes.</highlight></codeline>
<codeline lineno="1409"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1410"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>center<sp/>:<sp/>sequence[2]</highlight></codeline>
<codeline lineno="1411"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Window<sp/>coordinates<sp/>of<sp/>trackball<sp/>center.</highlight></codeline>
<codeline lineno="1412"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>radius<sp/>:<sp/>float</highlight></codeline>
<codeline lineno="1413"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Radius<sp/>of<sp/>trackball<sp/>in<sp/>window<sp/>coordinates.</highlight></codeline>
<codeline lineno="1414"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1415"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ad16d39f5af820bf504b1ba7a815c3394" kindref="member">_radius</ref><sp/>=<sp/>float(radius)</highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab1e8e28106f18d7e06515932e4aa51c2" kindref="member">_center</ref>[0]<sp/>=<sp/>center[0]</highlight></codeline>
<codeline lineno="1418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab1e8e28106f18d7e06515932e4aa51c2" kindref="member">_center</ref>[1]<sp/>=<sp/>center[1]</highlight></codeline>
<codeline lineno="1419"><highlight class="normal"></highlight></codeline>
<codeline lineno="1420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a588a6452bfaf8dbe4eb7be6c3227da39" kindref="member">setaxes</ref>(self,<sp/>*axes):</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Set<sp/>axes<sp/>to<sp/>constrain<sp/>rotations.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>axes<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a38c8d595804ed99514eddb97f085c6eb" kindref="member">_axes</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a38c8d595804ed99514eddb97f085c6eb" kindref="member">_axes</ref><sp/>=<sp/>[unit_vector(axis)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>axis<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>axes]</highlight></codeline>
<codeline lineno="1426"><highlight class="normal"></highlight></codeline>
<codeline lineno="1427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a4762b0e43eb78f5618744916cc3a2b9d" kindref="member">setconstrain</ref>(self,<sp/>constrain):</highlight></codeline>
<codeline lineno="1428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Set<sp/>state<sp/>of<sp/>constrain<sp/>to<sp/>axis<sp/>mode.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab4e36944aa3b36adb8dd66c508ba464c" kindref="member">_constrain</ref><sp/>=<sp/>constrain<sp/>==<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1430"><highlight class="normal"></highlight></codeline>
<codeline lineno="1431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a278a5ae4ec15e1b0f8944d6fb6648626" kindref="member">getconstrain</ref>(self):</highlight></codeline>
<codeline lineno="1432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>state<sp/>of<sp/>constrain<sp/>to<sp/>axis<sp/>mode.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab4e36944aa3b36adb8dd66c508ba464c" kindref="member">_constrain</ref></highlight></codeline>
<codeline lineno="1434"><highlight class="normal"></highlight></codeline>
<codeline lineno="1435"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a445d569b9993205e78d50bc02285645b" kindref="member">down</ref>(self,<sp/>point):</highlight></codeline>
<codeline lineno="1436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Set<sp/>initial<sp/>cursor<sp/>window<sp/>coordinates<sp/>and<sp/>pick<sp/>constrain-axis.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a425a773e487d2ff8e155d2abda08ed3c" kindref="member">_vdown</ref><sp/>=<sp/>arcball_map_to_sphere(point,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab1e8e28106f18d7e06515932e4aa51c2" kindref="member">_center</ref>,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ad16d39f5af820bf504b1ba7a815c3394" kindref="member">_radius</ref>)</highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a53556780b35448f185b4f8b4ec948a7d" kindref="member">_qdown</ref><sp/>=<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1afb1b380fdca25d52ed3f58df54a7b5fb" kindref="member">_qpre</ref><sp/>=<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref></highlight></codeline>
<codeline lineno="1439"><highlight class="normal"></highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab4e36944aa3b36adb8dd66c508ba464c" kindref="member">_constrain</ref><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a38c8d595804ed99514eddb97f085c6eb" kindref="member">_axes</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a60ba74ff0532693bd4f17305511f1ba9" kindref="member">_axis</ref><sp/>=<sp/>arcball_nearest_axis(self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a425a773e487d2ff8e155d2abda08ed3c" kindref="member">_vdown</ref>,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a38c8d595804ed99514eddb97f085c6eb" kindref="member">_axes</ref>)</highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a425a773e487d2ff8e155d2abda08ed3c" kindref="member">_vdown</ref><sp/>=<sp/>arcball_constrain_to_axis(self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a425a773e487d2ff8e155d2abda08ed3c" kindref="member">_vdown</ref>,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a60ba74ff0532693bd4f17305511f1ba9" kindref="member">_axis</ref>)</highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a60ba74ff0532693bd4f17305511f1ba9" kindref="member">_axis</ref><sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1445"><highlight class="normal"></highlight></codeline>
<codeline lineno="1446"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a807e222958b07e81f76ddd3c1453e5f7" kindref="member">drag</ref>(self,<sp/>point):</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Update<sp/>current<sp/>cursor<sp/>window<sp/>coordinates.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vnow<sp/>=<sp/>arcball_map_to_sphere(point,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ab1e8e28106f18d7e06515932e4aa51c2" kindref="member">_center</ref>,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ad16d39f5af820bf504b1ba7a815c3394" kindref="member">_radius</ref>)</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"></highlight></codeline>
<codeline lineno="1450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a60ba74ff0532693bd4f17305511f1ba9" kindref="member">_axis</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>vnow<sp/>=<sp/>arcball_constrain_to_axis(vnow,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a60ba74ff0532693bd4f17305511f1ba9" kindref="member">_axis</ref>)</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"></highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1afb1b380fdca25d52ed3f58df54a7b5fb" kindref="member">_qpre</ref><sp/>=<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref></highlight></codeline>
<codeline lineno="1454"><highlight class="normal"></highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t<sp/>=<sp/>numpy.cross(self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a425a773e487d2ff8e155d2abda08ed3c" kindref="member">_vdown</ref>,<sp/>vnow)</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>numpy.dot(t,<sp/>t)<sp/>&lt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref><sp/>=<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a53556780b35448f185b4f8b4ec948a7d" kindref="member">_qdown</ref></highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q<sp/>=<sp/>[t[0],<sp/>t[1],<sp/>t[2],<sp/>numpy.dot(self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a425a773e487d2ff8e155d2abda08ed3c" kindref="member">_vdown</ref>,<sp/>vnow)]</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref><sp/>=<sp/>quaternion_multiply(q,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a53556780b35448f185b4f8b4ec948a7d" kindref="member">_qdown</ref>)</highlight></codeline>
<codeline lineno="1461"><highlight class="normal"></highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a86d381f212c8419f323030bb7ababd5c" kindref="member">next</ref>(self,<sp/>acceleration=0.0):</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Continue<sp/>rotation<sp/>in<sp/>direction<sp/>of<sp/>last<sp/>drag.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>q<sp/>=<sp/>quaternion_slerp(self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1afb1b380fdca25d52ed3f58df54a7b5fb" kindref="member">_qpre</ref>,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref>,<sp/>2.0+acceleration,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1afb1b380fdca25d52ed3f58df54a7b5fb" kindref="member">_qpre</ref>,<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref><sp/>=<sp/>self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref>,<sp/>q</highlight></codeline>
<codeline lineno="1466"><highlight class="normal"></highlight></codeline>
<codeline lineno="1467"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1ae3843d15b32cebdf93221022a4e30b0e" kindref="member">matrix</ref>(self):</highlight></codeline>
<codeline lineno="1468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>homogeneous<sp/>rotation<sp/>matrix.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>quaternion_matrix(self.<ref refid="classtf__quaternion_1_1transformations_1_1Arcball_1a1709c200903d890cc187465f490d4205" kindref="member">_qnow</ref>)</highlight></codeline>
<codeline lineno="1470"><highlight class="normal"></highlight></codeline>
<codeline lineno="1471"><highlight class="normal"></highlight></codeline>
<codeline lineno="1472"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">arcball_map_to_sphere(point,<sp/>center,<sp/>radius):</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>unit<sp/>sphere<sp/>coordinates<sp/>from<sp/>window<sp/>coordinates.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1474"><highlight class="normal"><sp/><sp/><sp/><sp/>v<sp/>=<sp/>numpy.array(((point[0]<sp/>-<sp/>center[0])<sp/>/<sp/>radius,</highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(center[1]<sp/>-<sp/>point[1])<sp/>/<sp/>radius,</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0.0),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/><sp/><sp/>n<sp/>=<sp/>v[0]*v[0]<sp/>+<sp/>v[1]*v[1]</highlight></codeline>
<codeline lineno="1478"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>n<sp/>&gt;<sp/>1.0:</highlight></codeline>
<codeline lineno="1479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>/=<sp/>math.sqrt(n)<sp/></highlight><highlight class="comment">#<sp/>position<sp/>outside<sp/>of<sp/>sphere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v[2]<sp/>=<sp/>math.sqrt(1.0<sp/>-<sp/>n)</highlight></codeline>
<codeline lineno="1482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>v</highlight></codeline>
<codeline lineno="1483"><highlight class="normal"></highlight></codeline>
<codeline lineno="1484"><highlight class="normal"></highlight></codeline>
<codeline lineno="1485"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">arcball_constrain_to_axis(point,<sp/>axis):</highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>sphere<sp/>point<sp/>perpendicular<sp/>to<sp/>axis.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/><sp/><sp/>v<sp/>=<sp/>numpy.array(point,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1488"><highlight class="normal"><sp/><sp/><sp/><sp/>a<sp/>=<sp/>numpy.array(axis,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/><sp/><sp/>v<sp/>-=<sp/>a<sp/>*<sp/>numpy.dot(a,<sp/>v)<sp/></highlight><highlight class="comment">#<sp/>on<sp/>plane</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><sp/><sp/>n<sp/>=<sp/>vector_norm(v)</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>n<sp/>&gt;<sp/>_EPS:</highlight></codeline>
<codeline lineno="1492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>v[2]<sp/>&lt;<sp/>0.0:</highlight></codeline>
<codeline lineno="1493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>*=<sp/>-1.0</highlight></codeline>
<codeline lineno="1494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>/=<sp/>n</highlight></codeline>
<codeline lineno="1495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>v</highlight></codeline>
<codeline lineno="1496"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>a[2]<sp/>==<sp/>1.0:</highlight></codeline>
<codeline lineno="1497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.array([1,<sp/>0,<sp/>0],<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>unit_vector([-a[1],<sp/>a[0],<sp/>0])</highlight></codeline>
<codeline lineno="1499"><highlight class="normal"></highlight></codeline>
<codeline lineno="1500"><highlight class="normal"></highlight></codeline>
<codeline lineno="1501"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">arcball_nearest_axis(point,<sp/>axes):</highlight></codeline>
<codeline lineno="1502"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>axis,<sp/>which<sp/>arc<sp/>is<sp/>nearest<sp/>to<sp/>point.&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1503"><highlight class="normal"><sp/><sp/><sp/><sp/>point<sp/>=<sp/>numpy.array(point,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1504"><highlight class="normal"><sp/><sp/><sp/><sp/>nearest<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1505"><highlight class="normal"><sp/><sp/><sp/><sp/>mx<sp/>=<sp/>-1.0</highlight></codeline>
<codeline lineno="1506"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>axis<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>axes:</highlight></codeline>
<codeline lineno="1507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t<sp/>=<sp/>numpy.dot(arcball_constrain_to_axis(point,<sp/>axis),<sp/>point)</highlight></codeline>
<codeline lineno="1508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>t<sp/>&gt;<sp/>mx:</highlight></codeline>
<codeline lineno="1509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nearest<sp/>=<sp/>axis</highlight></codeline>
<codeline lineno="1510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mx<sp/>=<sp/>t</highlight></codeline>
<codeline lineno="1511"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>nearest</highlight></codeline>
<codeline lineno="1512"><highlight class="normal"></highlight></codeline>
<codeline lineno="1513"><highlight class="normal"></highlight></codeline>
<codeline lineno="1514"><highlight class="normal"></highlight><highlight class="comment">#<sp/>epsilon<sp/>for<sp/>testing<sp/>whether<sp/>a<sp/>number<sp/>is<sp/>close<sp/>to<sp/>zero</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1515"><highlight class="normal">_EPS<sp/>=<sp/>numpy.finfo(float).eps<sp/>*<sp/>4.0</highlight></codeline>
<codeline lineno="1516"><highlight class="normal"></highlight></codeline>
<codeline lineno="1517"><highlight class="normal"></highlight><highlight class="comment">#<sp/>axis<sp/>sequences<sp/>for<sp/>Euler<sp/>angles</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1518"><highlight class="normal">_NEXT_AXIS<sp/>=<sp/>[1,<sp/>2,<sp/>0,<sp/>1]</highlight></codeline>
<codeline lineno="1519"><highlight class="normal"></highlight></codeline>
<codeline lineno="1520"><highlight class="normal"></highlight><highlight class="comment">#<sp/>map<sp/>axes<sp/>strings<sp/>to/from<sp/>tuples<sp/>of<sp/>inner<sp/>axis,<sp/>parity,<sp/>repetition,<sp/>frame</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1521"><highlight class="normal">_AXES2TUPLE<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="1522"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sxyz&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>0,<sp/>0,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;sxyx&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>0,<sp/>1,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;sxzy&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>1,<sp/>0,<sp/>0),</highlight></codeline>
<codeline lineno="1523"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;sxzx&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>1,<sp/>1,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;syzx&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>0,<sp/>0,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;syzy&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>0,<sp/>1,<sp/>0),</highlight></codeline>
<codeline lineno="1524"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;syxz&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>1,<sp/>0,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;syxy&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>1,<sp/>1,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;szxy&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>0,<sp/>0,<sp/>0),</highlight></codeline>
<codeline lineno="1525"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;szxz&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>0,<sp/>1,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;szyx&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>1,<sp/>0,<sp/>0),<sp/></highlight><highlight class="stringliteral">&apos;szyz&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>1,<sp/>1,<sp/>0),</highlight></codeline>
<codeline lineno="1526"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rzyx&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>0,<sp/>0,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;rxyx&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>0,<sp/>1,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;ryzx&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>1,<sp/>0,<sp/>1),</highlight></codeline>
<codeline lineno="1527"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rxzx&apos;</highlight><highlight class="normal">:<sp/>(0,<sp/>1,<sp/>1,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;rxzy&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>0,<sp/>0,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;ryzy&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>0,<sp/>1,<sp/>1),</highlight></codeline>
<codeline lineno="1528"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rzxy&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>1,<sp/>0,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;ryxy&apos;</highlight><highlight class="normal">:<sp/>(1,<sp/>1,<sp/>1,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;ryxz&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>0,<sp/>0,<sp/>1),</highlight></codeline>
<codeline lineno="1529"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;rzxz&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>0,<sp/>1,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;rxyz&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>1,<sp/>0,<sp/>1),<sp/></highlight><highlight class="stringliteral">&apos;rzyz&apos;</highlight><highlight class="normal">:<sp/>(2,<sp/>1,<sp/>1,<sp/>1)}</highlight></codeline>
<codeline lineno="1530"><highlight class="normal"></highlight></codeline>
<codeline lineno="1531"><highlight class="normal">_TUPLE2AXES<sp/>=<sp/>dict((v,<sp/>k)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>k,<sp/>v<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>_AXES2TUPLE.items())</highlight></codeline>
<codeline lineno="1532"><highlight class="normal"></highlight></codeline>
<codeline lineno="1533"><highlight class="normal"></highlight><highlight class="comment">#<sp/>helper<sp/>functions</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1534"><highlight class="normal"></highlight></codeline>
<codeline lineno="1535"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">vector_norm(data,<sp/>axis=None,<sp/>out=None):</highlight></codeline>
<codeline lineno="1536"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>length,<sp/>i.e.<sp/>eucledian<sp/>norm,<sp/>of<sp/>ndarray<sp/>along<sp/>axis.</highlight></codeline>
<codeline lineno="1537"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1538"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>numpy.random.random(3)</highlight></codeline>
<codeline lineno="1539"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>n<sp/>=<sp/>vector_norm(v)</highlight></codeline>
<codeline lineno="1540"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(n,<sp/>numpy.linalg.norm(v))</highlight></codeline>
<codeline lineno="1541"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1542"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>numpy.random.rand(6,<sp/>5,<sp/>3)</highlight></codeline>
<codeline lineno="1543"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>n<sp/>=<sp/>vector_norm(v,<sp/>axis=-1)</highlight></codeline>
<codeline lineno="1544"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(n,<sp/>numpy.sqrt(numpy.sum(v*v,<sp/>axis=2)))</highlight></codeline>
<codeline lineno="1545"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1546"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>n<sp/>=<sp/>vector_norm(v,<sp/>axis=1)</highlight></codeline>
<codeline lineno="1547"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(n,<sp/>numpy.sqrt(numpy.sum(v*v,<sp/>axis=1)))</highlight></codeline>
<codeline lineno="1548"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1549"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>numpy.random.rand(5,<sp/>4,<sp/>3)</highlight></codeline>
<codeline lineno="1550"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>n<sp/>=<sp/>numpy.empty((5,<sp/>3),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1551"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>vector_norm(v,<sp/>axis=1,<sp/>out=n)</highlight></codeline>
<codeline lineno="1552"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(n,<sp/>numpy.sqrt(numpy.sum(v*v,<sp/>axis=1)))</highlight></codeline>
<codeline lineno="1553"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1554"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>vector_norm([])</highlight></codeline>
<codeline lineno="1555"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>0.0</highlight></codeline>
<codeline lineno="1556"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>vector_norm([1.0])</highlight></codeline>
<codeline lineno="1557"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>1.0</highlight></codeline>
<codeline lineno="1558"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1559"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1560"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/>=<sp/>numpy.array(data,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>out<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>data.ndim<sp/>==<sp/>1:</highlight></codeline>
<codeline lineno="1563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>math.sqrt(numpy.dot(data,<sp/>data))</highlight></codeline>
<codeline lineno="1564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>*=<sp/>data</highlight></codeline>
<codeline lineno="1565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out<sp/>=<sp/>numpy.atleast_1d(numpy.sum(data,<sp/>axis=axis))</highlight></codeline>
<codeline lineno="1566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numpy.sqrt(out,<sp/>out)</highlight></codeline>
<codeline lineno="1567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>out</highlight></codeline>
<codeline lineno="1568"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>*=<sp/>data</highlight></codeline>
<codeline lineno="1570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numpy.sum(data,<sp/>axis=axis,<sp/>out=out)</highlight></codeline>
<codeline lineno="1571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numpy.sqrt(out,<sp/>out)</highlight></codeline>
<codeline lineno="1572"><highlight class="normal"></highlight></codeline>
<codeline lineno="1573"><highlight class="normal"></highlight></codeline>
<codeline lineno="1574"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">unit_vector(data,<sp/>axis=None,<sp/>out=None):</highlight></codeline>
<codeline lineno="1575"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>ndarray<sp/>normalized<sp/>by<sp/>length,<sp/>i.e.<sp/>eucledian<sp/>norm,<sp/>along<sp/>axis.</highlight></codeline>
<codeline lineno="1576"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1577"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>numpy.random.random(3)</highlight></codeline>
<codeline lineno="1578"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>unit_vector(v0)</highlight></codeline>
<codeline lineno="1579"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>v0<sp/>/<sp/>numpy.linalg.norm(v0))</highlight></codeline>
<codeline lineno="1580"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1581"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>numpy.random.rand(5,<sp/>4,<sp/>3)</highlight></codeline>
<codeline lineno="1582"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>unit_vector(v0,<sp/>axis=-1)</highlight></codeline>
<codeline lineno="1583"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v2<sp/>=<sp/>v0<sp/>/<sp/>numpy.expand_dims(numpy.sqrt(numpy.sum(v0*v0,<sp/>axis=2)),<sp/>2)</highlight></codeline>
<codeline lineno="1584"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>v2)</highlight></codeline>
<codeline lineno="1585"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1586"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>unit_vector(v0,<sp/>axis=1)</highlight></codeline>
<codeline lineno="1587"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v2<sp/>=<sp/>v0<sp/>/<sp/>numpy.expand_dims(numpy.sqrt(numpy.sum(v0*v0,<sp/>axis=1)),<sp/>1)</highlight></codeline>
<codeline lineno="1588"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>v2)</highlight></codeline>
<codeline lineno="1589"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1590"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>numpy.empty((5,<sp/>4,<sp/>3),<sp/>dtype=numpy.float64)</highlight></codeline>
<codeline lineno="1591"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>unit_vector(v0,<sp/>axis=1,<sp/>out=v1)</highlight></codeline>
<codeline lineno="1592"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(v1,<sp/>v2)</highlight></codeline>
<codeline lineno="1593"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1594"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>list(unit_vector([]))</highlight></codeline>
<codeline lineno="1595"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>[]</highlight></codeline>
<codeline lineno="1596"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>list(unit_vector([1.0]))</highlight></codeline>
<codeline lineno="1597"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>[1.0]</highlight></codeline>
<codeline lineno="1598"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1599"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>out<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>numpy.array(data,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>data.ndim<sp/>==<sp/>1:</highlight></codeline>
<codeline lineno="1603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>/=<sp/>math.sqrt(numpy.dot(data,<sp/>data))</highlight></codeline>
<codeline lineno="1604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data</highlight></codeline>
<codeline lineno="1605"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>out<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>data:</highlight></codeline>
<codeline lineno="1607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out[:]<sp/>=<sp/>numpy.array(data,<sp/>copy=</highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>data<sp/>=<sp/>out</highlight></codeline>
<codeline lineno="1609"><highlight class="normal"><sp/><sp/><sp/><sp/>length<sp/>=<sp/>numpy.atleast_1d(numpy.sum(data*data,<sp/>axis))</highlight></codeline>
<codeline lineno="1610"><highlight class="normal"><sp/><sp/><sp/><sp/>numpy.sqrt(length,<sp/>length)</highlight></codeline>
<codeline lineno="1611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>axis<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>length<sp/>=<sp/>numpy.expand_dims(length,<sp/>axis)</highlight></codeline>
<codeline lineno="1613"><highlight class="normal"><sp/><sp/><sp/><sp/>data<sp/>/=<sp/>length</highlight></codeline>
<codeline lineno="1614"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>out<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1615"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>data</highlight></codeline>
<codeline lineno="1616"><highlight class="normal"></highlight></codeline>
<codeline lineno="1617"><highlight class="normal"></highlight></codeline>
<codeline lineno="1618"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">random_vector(size):</highlight></codeline>
<codeline lineno="1619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>array<sp/>of<sp/>random<sp/>doubles<sp/>in<sp/>the<sp/>half-open<sp/>interval<sp/>[0.0,<sp/>1.0).</highlight></codeline>
<codeline lineno="1620"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1621"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v<sp/>=<sp/>random_vector(10000)</highlight></codeline>
<codeline lineno="1622"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.all(v<sp/>&gt;=<sp/>0.0)<sp/>and<sp/>numpy.all(v<sp/>&lt;<sp/>1.0)</highlight></codeline>
<codeline lineno="1623"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1624"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v0<sp/>=<sp/>random_vector(10)</highlight></codeline>
<codeline lineno="1625"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>v1<sp/>=<sp/>random_vector(10)</highlight></codeline>
<codeline lineno="1626"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.any(v0<sp/>==<sp/>v1)</highlight></codeline>
<codeline lineno="1627"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>False</highlight></codeline>
<codeline lineno="1628"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1629"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.random.random(size)</highlight></codeline>
<codeline lineno="1631"><highlight class="normal"></highlight></codeline>
<codeline lineno="1632"><highlight class="normal"></highlight></codeline>
<codeline lineno="1633"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">inverse_matrix(matrix):</highlight></codeline>
<codeline lineno="1634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>inverse<sp/>of<sp/>square<sp/>transformation<sp/>matrix.</highlight></codeline>
<codeline lineno="1635"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1636"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M0<sp/>=<sp/>random_rotation_matrix()</highlight></codeline>
<codeline lineno="1637"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M1<sp/>=<sp/>inverse_matrix(M0.T)</highlight></codeline>
<codeline lineno="1638"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(M1,<sp/>numpy.linalg.inv(M0.T))</highlight></codeline>
<codeline lineno="1639"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1640"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>for<sp/>size<sp/>in<sp/>range(1,<sp/>7):</highlight></codeline>
<codeline lineno="1641"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/><sp/>M0<sp/>=<sp/>numpy.random.rand(size,<sp/>size)</highlight></codeline>
<codeline lineno="1642"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/><sp/>M1<sp/>=<sp/>inverse_matrix(M0)</highlight></codeline>
<codeline lineno="1643"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>...<sp/><sp/><sp/><sp/><sp/>if<sp/>not<sp/>numpy.allclose(M1,<sp/>numpy.linalg.inv(M0)):<sp/>print<sp/>size</highlight></codeline>
<codeline lineno="1644"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1645"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1646"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.linalg.inv(matrix)</highlight></codeline>
<codeline lineno="1647"><highlight class="normal"></highlight></codeline>
<codeline lineno="1648"><highlight class="normal"></highlight></codeline>
<codeline lineno="1649"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">concatenate_matrices(*matrices):</highlight></codeline>
<codeline lineno="1650"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>concatenation<sp/>of<sp/>series<sp/>of<sp/>transformation<sp/>matrices.</highlight></codeline>
<codeline lineno="1651"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1652"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>M<sp/>=<sp/>numpy.random.rand(16).reshape((4,<sp/>4))<sp/>-<sp/>0.5</highlight></codeline>
<codeline lineno="1653"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(M,<sp/>concatenate_matrices(M))</highlight></codeline>
<codeline lineno="1654"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1655"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>numpy.allclose(numpy.dot(M,<sp/>M.T),<sp/>concatenate_matrices(M,<sp/>M.T))</highlight></codeline>
<codeline lineno="1656"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1657"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1658"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1659"><highlight class="normal"><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.identity(4)</highlight></codeline>
<codeline lineno="1660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>matrices:</highlight></codeline>
<codeline lineno="1661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>M<sp/>=<sp/>numpy.dot(M,<sp/>i)</highlight></codeline>
<codeline lineno="1662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>M</highlight></codeline>
<codeline lineno="1663"><highlight class="normal"></highlight></codeline>
<codeline lineno="1664"><highlight class="normal"></highlight></codeline>
<codeline lineno="1665"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">is_same_transform(matrix0,<sp/>matrix1):</highlight></codeline>
<codeline lineno="1666"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Return<sp/>True<sp/>if<sp/>two<sp/>matrices<sp/>perform<sp/>same<sp/>transformation.</highlight></codeline>
<codeline lineno="1667"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1668"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(numpy.identity(4),<sp/>numpy.identity(4))</highlight></codeline>
<codeline lineno="1669"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>True</highlight></codeline>
<codeline lineno="1670"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&gt;&gt;&gt;<sp/>is_same_transform(numpy.identity(4),<sp/>random_rotation_matrix())</highlight></codeline>
<codeline lineno="1671"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>False</highlight></codeline>
<codeline lineno="1672"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1673"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1674"><highlight class="normal"><sp/><sp/><sp/><sp/>matrix0<sp/>=<sp/>numpy.array(matrix0,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1675"><highlight class="normal"><sp/><sp/><sp/><sp/>matrix0<sp/>/=<sp/>matrix0[3,<sp/>3]</highlight></codeline>
<codeline lineno="1676"><highlight class="normal"><sp/><sp/><sp/><sp/>matrix1<sp/>=<sp/>numpy.array(matrix1,<sp/>dtype=numpy.float64,<sp/>copy=</highlight><highlight class="keyword">True</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="1677"><highlight class="normal"><sp/><sp/><sp/><sp/>matrix1<sp/>/=<sp/>matrix1[3,<sp/>3]</highlight></codeline>
<codeline lineno="1678"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>numpy.allclose(matrix0,<sp/>matrix1)</highlight></codeline>
<codeline lineno="1679"><highlight class="normal"></highlight></codeline>
<codeline lineno="1680"><highlight class="normal"></highlight></codeline>
<codeline lineno="1681"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">_import_module(module_name,<sp/>warn=True,<sp/>prefix=&apos;_py_&apos;,<sp/>ignore=&apos;_&apos;):</highlight></codeline>
<codeline lineno="1682"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;Try<sp/>import<sp/>all<sp/>public<sp/>attributes<sp/>from<sp/>module<sp/>into<sp/>global<sp/>namespace.</highlight></codeline>
<codeline lineno="1683"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1684"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Existing<sp/>attributes<sp/>with<sp/>name<sp/>clashes<sp/>are<sp/>renamed<sp/>with<sp/>prefix.</highlight></codeline>
<codeline lineno="1685"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Attributes<sp/>starting<sp/>with<sp/>underscore<sp/>are<sp/>ignored<sp/>by<sp/>default.</highlight></codeline>
<codeline lineno="1686"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1687"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Return<sp/>True<sp/>on<sp/>successful<sp/>import.</highlight></codeline>
<codeline lineno="1688"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1689"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>module<sp/>=<sp/>__import__(module_name)</highlight></codeline>
<codeline lineno="1692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ImportError:</highlight></codeline>
<codeline lineno="1693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>warn:</highlight></codeline>
<codeline lineno="1694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>warnings.warn(</highlight><highlight class="stringliteral">&quot;Failed<sp/>to<sp/>import<sp/>module<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>module_name)</highlight></codeline>
<codeline lineno="1695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>attr<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>dir(module):</highlight></codeline>
<codeline lineno="1697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ignore<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>attr.startswith(ignore):</highlight></codeline>
<codeline lineno="1698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>prefix:</highlight></codeline>
<codeline lineno="1700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>attr<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>globals():</highlight></codeline>
<codeline lineno="1701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>globals()[prefix<sp/>+<sp/>attr]<sp/>=<sp/>globals()[attr]</highlight></codeline>
<codeline lineno="1702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>warn:</highlight></codeline>
<codeline lineno="1703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>warnings.warn(</highlight><highlight class="stringliteral">&quot;No<sp/>Python<sp/>implementation<sp/>of<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/>attr)</highlight></codeline>
<codeline lineno="1704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>globals()[attr]<sp/>=<sp/>getattr(module,<sp/>attr)</highlight></codeline>
<codeline lineno="1705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="src/tf_quaternion/transformations.py"/>
  </compounddef>
</doxygen>
